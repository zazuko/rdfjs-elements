import{S as Kt}from"./index-BOvYCoiN.js";import{r as Bt,a as kt,f as Gt,b as $t}from"./index-CP8saq_h.js";import{r as Jt}from"./readable-BmS1kvD9.js";import{r as Fe,a as Mt}from"./index-x9JHQWz9.js";import{r as _t}from"./canonicalize-CMDVY_Xn.js";var q={},z={},Ne,Be;function qt(){if(Be)return Ne;Be=1;var{Buffer:d}=Bt(),E={},a=E.LEFT_BRACE=1,g=E.RIGHT_BRACE=2,f=E.LEFT_BRACKET=3,c=E.RIGHT_BRACKET=4,t=E.COLON=5,r=E.COMMA=6,n=E.TRUE=7,e=E.FALSE=8,l=E.NULL=9,o=E.STRING=10,s=E.NUMBER=11,u=E.START=17,h=E.STOP=18,p=E.TRUE1=33,b=E.TRUE2=34,O=E.TRUE3=35,x=E.FALSE1=49,m=E.FALSE2=50,A=E.FALSE3=51,w=E.FALSE4=52,C=E.NULL1=65,S=E.NULL2=66,L=E.NULL3=67,y=E.NUMBER1=81,I=E.NUMBER3=83,T=E.STRING1=97,D=E.STRING2=98,P=E.STRING3=99,N=E.STRING4=100,H=E.STRING5=101,U=E.STRING6=102,B=E.VALUE=113,Te=E.KEY=114,be=E.OBJECT=129,xe=E.ARRAY=130,Dt=92,Pt=47,Vt=8,Ut=12,Ht=10,Ft=13,jt=9,Ae=64*1024;function Oe(_){return d.alloc?d.alloc(_):new d(_)}function k(){this.tState=u,this.value=void 0,this.string=void 0,this.stringBuffer=Oe(Ae),this.stringBufferOffset=0,this.unicode=void 0,this.highSurrogate=void 0,this.key=void 0,this.mode=void 0,this.stack=[],this.state=B,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:Oe(2),3:Oe(3),4:Oe(4)},this.offset=-1}k.toknam=function(_){for(var R=Object.keys(E),v=0,K=R.length;v<K;v++){var G=R[v];if(E[G]===_)return G}return _&&"0x"+_.toString(16)};var j=k.prototype;return j.onError=function(_){throw _},j.charError=function(_,R){this.tState=h,this.onError(new Error("Unexpected "+JSON.stringify(String.fromCharCode(_[R]))+" at position "+R+" in state "+k.toknam(this.tState)))},j.appendStringChar=function(_){this.stringBufferOffset>=Ae&&(this.string+=this.stringBuffer.toString("utf8"),this.stringBufferOffset=0),this.stringBuffer[this.stringBufferOffset++]=_},j.appendStringBuf=function(_,R,v){var K=_.length;typeof R=="number"&&(typeof v=="number"?v<0?K=_.length-R+v:K=v-R:K=_.length-R),K<0&&(K=0),this.stringBufferOffset+K>Ae&&(this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset),this.stringBufferOffset=0),_.copy(this.stringBuffer,this.stringBufferOffset,R,v),this.stringBufferOffset+=K},j.write=function(_){typeof _=="string"&&(_=new d(_));for(var R,v=0,K=_.length;v<K;v++)if(this.tState===u){if(R=_[v],this.offset++,R===123)this.onToken(a,"{");else if(R===125)this.onToken(g,"}");else if(R===91)this.onToken(f,"[");else if(R===93)this.onToken(c,"]");else if(R===58)this.onToken(t,":");else if(R===44)this.onToken(r,",");else if(R===116)this.tState=p;else if(R===102)this.tState=x;else if(R===110)this.tState=C;else if(R===34)this.string="",this.stringBufferOffset=0,this.tState=T;else if(R===45)this.string="-",this.tState=y;else if(R>=48&&R<64)this.string=String.fromCharCode(R),this.tState=I;else if(!(R===32||R===9||R===10||R===13))return this.charError(_,v)}else if(this.tState===T)if(R=_[v],this.bytes_remaining>0){for(var G=0;G<this.bytes_remaining;G++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+G]=_[G];this.appendStringBuf(this.temp_buffs[this.bytes_in_sequence]),this.bytes_in_sequence=this.bytes_remaining=0,v=v+G-1}else if(this.bytes_remaining===0&&R>=128){if(R<=193||R>244)return this.onError(new Error("Invalid UTF-8 character at position "+v+" in state "+k.toknam(this.tState)));if(R>=194&&R<=223&&(this.bytes_in_sequence=2),R>=224&&R<=239&&(this.bytes_in_sequence=3),R>=240&&R<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+v>_.length){for(var me=0;me<=_.length-1-v;me++)this.temp_buffs[this.bytes_in_sequence][me]=_[v+me];this.bytes_remaining=v+this.bytes_in_sequence-_.length,v=_.length-1}else this.appendStringBuf(_,v,v+this.bytes_in_sequence),v=v+this.bytes_in_sequence-1}else if(R===34)this.tState=u,this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset),this.stringBufferOffset=0,this.onToken(o,this.string),this.offset+=d.byteLength(this.string,"utf8")+1,this.string=void 0;else if(R===92)this.tState=D;else if(R>=32)this.appendStringChar(R);else return this.charError(_,v);else if(this.tState===D)if(R=_[v],R===34)this.appendStringChar(R),this.tState=T;else if(R===92)this.appendStringChar(Dt),this.tState=T;else if(R===47)this.appendStringChar(Pt),this.tState=T;else if(R===98)this.appendStringChar(Vt),this.tState=T;else if(R===102)this.appendStringChar(Ut),this.tState=T;else if(R===110)this.appendStringChar(Ht),this.tState=T;else if(R===114)this.appendStringChar(Ft),this.tState=T;else if(R===116)this.appendStringChar(jt),this.tState=T;else if(R===117)this.unicode="",this.tState=P;else return this.charError(_,v);else if(this.tState===P||this.tState===N||this.tState===H||this.tState===U)if(R=_[v],R>=48&&R<64||R>64&&R<=70||R>96&&R<=102){if(this.unicode+=String.fromCharCode(R),this.tState++===U){var M=parseInt(this.unicode,16);this.unicode=void 0,this.highSurrogate!==void 0&&M>=56320&&M<57344?(this.appendStringBuf(new d(String.fromCharCode(this.highSurrogate,M))),this.highSurrogate=void 0):this.highSurrogate===void 0&&M>=55296&&M<56320?this.highSurrogate=M:(this.highSurrogate!==void 0&&(this.appendStringBuf(new d(String.fromCharCode(this.highSurrogate))),this.highSurrogate=void 0),this.appendStringBuf(new d(String.fromCharCode(M)))),this.tState=T}}else return this.charError(_,v);else if(this.tState===y||this.tState===I)switch(R=_[v],R){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 46:case 101:case 69:case 43:case 45:this.string+=String.fromCharCode(R),this.tState=I;break;default:this.tState=u;var Ke=this.numberReviver(this.string);if(Ke)return Ke;this.offset+=this.string.length-1,this.string=void 0,v--;break}else if(this.tState===p)if(_[v]===114)this.tState=b;else return this.charError(_,v);else if(this.tState===b)if(_[v]===117)this.tState=O;else return this.charError(_,v);else if(this.tState===O)if(_[v]===101)this.tState=u,this.onToken(n,!0),this.offset+=3;else return this.charError(_,v);else if(this.tState===x)if(_[v]===97)this.tState=m;else return this.charError(_,v);else if(this.tState===m)if(_[v]===108)this.tState=A;else return this.charError(_,v);else if(this.tState===A)if(_[v]===115)this.tState=w;else return this.charError(_,v);else if(this.tState===w)if(_[v]===101)this.tState=u,this.onToken(e,!1),this.offset+=4;else return this.charError(_,v);else if(this.tState===C)if(_[v]===117)this.tState=S;else return this.charError(_,v);else if(this.tState===S)if(_[v]===108)this.tState=L;else return this.charError(_,v);else if(this.tState===L)if(_[v]===108)this.tState=u,this.onToken(l,null),this.offset+=3;else return this.charError(_,v)},j.onToken=function(_,R){},j.parseError=function(_,R){this.tState=h,this.onError(new Error("Unexpected "+k.toknam(_)+(R?"("+JSON.stringify(R)+")":"")+" in state "+k.toknam(this.state)))},j.push=function(){this.stack.push({value:this.value,key:this.key,mode:this.mode})},j.pop=function(){var _=this.value,R=this.stack.pop();this.value=R.value,this.key=R.key,this.mode=R.mode,this.emit(_),this.mode||(this.state=B)},j.emit=function(_){this.mode&&(this.state=r),this.onValue(_)},j.onValue=function(_){},j.onToken=function(_,R){if(this.state===B)if(_===o||_===s||_===n||_===e||_===l)this.value&&(this.value[this.key]=R),this.emit(R);else if(_===a)this.push(),this.value?this.value=this.value[this.key]={}:this.value={},this.key=void 0,this.state=Te,this.mode=be;else if(_===f)this.push(),this.value?this.value=this.value[this.key]=[]:this.value=[],this.key=0,this.mode=xe,this.state=B;else if(_===g)if(this.mode===be)this.pop();else return this.parseError(_,R);else if(_===c)if(this.mode===xe)this.pop();else return this.parseError(_,R);else return this.parseError(_,R);else if(this.state===Te)if(_===o)this.key=R,this.state=t;else if(_===g)this.pop();else return this.parseError(_,R);else if(this.state===t)if(_===t)this.state=B;else return this.parseError(_,R);else if(this.state===r)if(_===r)this.mode===xe?(this.key++,this.state=B):this.mode===be&&(this.state=Te);else if(_===c&&this.mode===xe||_===g&&this.mode===be)this.pop();else return this.parseError(_,R);else return this.parseError(_,R)},j.numberReviver=function(_){var R=Number(_);if(isNaN(R))return this.charError(buffer,i);_.match(/[0-9]+/)==_&&R.toString()!=_?this.onToken(o,_):this.onToken(s,R)},k.C=E,Ne=k,Ne}var X={},ve={},Le={},ke;function Rt(){return ke||(ke=1,function(){(function(d){(function(E){var a={searchParams:"URLSearchParams"in d,iterable:"Symbol"in d&&"iterator"in Symbol,blob:"FileReader"in d&&"Blob"in d&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in d,arrayBuffer:"ArrayBuffer"in d};function g(y){return y&&DataView.prototype.isPrototypeOf(y)}if(a.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(y){return y&&f.indexOf(Object.prototype.toString.call(y))>-1};function t(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(y))throw new TypeError("Invalid character in header field name");return y.toLowerCase()}function r(y){return typeof y!="string"&&(y=String(y)),y}function n(y){var I={next:function(){var T=y.shift();return{done:T===void 0,value:T}}};return a.iterable&&(I[Symbol.iterator]=function(){return I}),I}function e(y){this.map={},y instanceof e?y.forEach(function(I,T){this.append(T,I)},this):Array.isArray(y)?y.forEach(function(I){this.append(I[0],I[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(I){this.append(I,y[I])},this)}e.prototype.append=function(y,I){y=t(y),I=r(I);var T=this.map[y];this.map[y]=T?T+", "+I:I},e.prototype.delete=function(y){delete this.map[t(y)]},e.prototype.get=function(y){return y=t(y),this.has(y)?this.map[y]:null},e.prototype.has=function(y){return this.map.hasOwnProperty(t(y))},e.prototype.set=function(y,I){this.map[t(y)]=r(I)},e.prototype.forEach=function(y,I){for(var T in this.map)this.map.hasOwnProperty(T)&&y.call(I,this.map[T],T,this)},e.prototype.keys=function(){var y=[];return this.forEach(function(I,T){y.push(T)}),n(y)},e.prototype.values=function(){var y=[];return this.forEach(function(I){y.push(I)}),n(y)},e.prototype.entries=function(){var y=[];return this.forEach(function(I,T){y.push([T,I])}),n(y)},a.iterable&&(e.prototype[Symbol.iterator]=e.prototype.entries);function l(y){if(y.bodyUsed)return Promise.reject(new TypeError("Already read"));y.bodyUsed=!0}function o(y){return new Promise(function(I,T){y.onload=function(){I(y.result)},y.onerror=function(){T(y.error)}})}function s(y){var I=new FileReader,T=o(I);return I.readAsArrayBuffer(y),T}function u(y){var I=new FileReader,T=o(I);return I.readAsText(y),T}function h(y){for(var I=new Uint8Array(y),T=new Array(I.length),D=0;D<I.length;D++)T[D]=String.fromCharCode(I[D]);return T.join("")}function p(y){if(y.slice)return y.slice(0);var I=new Uint8Array(y.byteLength);return I.set(new Uint8Array(y)),I.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(y){this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:a.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:a.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():a.arrayBuffer&&a.blob&&g(y)?(this._bodyArrayBuffer=p(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||c(y))?this._bodyArrayBuffer=p(y):this._bodyText=y=Object.prototype.toString.call(y):this._bodyText="",this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var y=l(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?l(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(s)}),this.text=function(){var y=l(this);if(y)return y;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(h(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(A)}),this.json=function(){return this.text().then(JSON.parse)},this}var O=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function x(y){var I=y.toUpperCase();return O.indexOf(I)>-1?I:y}function m(y,I){I=I||{};var T=I.body;if(y instanceof m){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,I.headers||(this.headers=new e(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,!T&&y._bodyInit!=null&&(T=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=I.credentials||this.credentials||"same-origin",(I.headers||!this.headers)&&(this.headers=new e(I.headers)),this.method=x(I.method||this.method||"GET"),this.mode=I.mode||this.mode||null,this.signal=I.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&T)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(T)}m.prototype.clone=function(){return new m(this,{body:this._bodyInit})};function A(y){var I=new FormData;return y.trim().split("&").forEach(function(T){if(T){var D=T.split("="),P=D.shift().replace(/\+/g," "),N=D.join("=").replace(/\+/g," ");I.append(decodeURIComponent(P),decodeURIComponent(N))}}),I}function w(y){var I=new e,T=y.replace(/\r?\n[\t ]+/g," ");return T.split(/\r?\n/).forEach(function(D){var P=D.split(":"),N=P.shift().trim();if(N){var H=P.join(":").trim();I.append(N,H)}}),I}b.call(m.prototype);function C(y,I){I||(I={}),this.type="default",this.status=I.status===void 0?200:I.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in I?I.statusText:"OK",this.headers=new e(I.headers),this.url=I.url||"",this._initBody(y)}b.call(C.prototype),C.prototype.clone=function(){return new C(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new e(this.headers),url:this.url})},C.error=function(){var y=new C(null,{status:0,statusText:""});return y.type="error",y};var S=[301,302,303,307,308];C.redirect=function(y,I){if(S.indexOf(I)===-1)throw new RangeError("Invalid status code");return new C(null,{status:I,headers:{location:y}})},E.DOMException=d.DOMException;try{new E.DOMException}catch{E.DOMException=function(I,T){this.message=I,this.name=T;var D=Error(I);this.stack=D.stack},E.DOMException.prototype=Object.create(Error.prototype),E.DOMException.prototype.constructor=E.DOMException}function L(y,I){return new Promise(function(T,D){var P=new m(y,I);if(P.signal&&P.signal.aborted)return D(new E.DOMException("Aborted","AbortError"));var N=new XMLHttpRequest;function H(){N.abort()}N.onload=function(){var U={status:N.status,statusText:N.statusText,headers:w(N.getAllResponseHeaders()||"")};U.url="responseURL"in N?N.responseURL:U.headers.get("X-Request-URL");var B="response"in N?N.response:N.responseText;T(new C(B,U))},N.onerror=function(){D(new TypeError("Network request failed"))},N.ontimeout=function(){D(new TypeError("Network request failed"))},N.onabort=function(){D(new E.DOMException("Aborted","AbortError"))},N.open(P.method,P.url,!0),P.credentials==="include"?N.withCredentials=!0:P.credentials==="omit"&&(N.withCredentials=!1),"responseType"in N&&a.blob&&(N.responseType="blob"),P.headers.forEach(function(U,B){N.setRequestHeader(B,U)}),P.signal&&(P.signal.addEventListener("abort",H),N.onreadystatechange=function(){N.readyState===4&&P.signal.removeEventListener("abort",H)}),N.send(typeof P._bodyInit>"u"?null:P._bodyInit)})}return L.polyfill=!0,d.fetch||(d.fetch=L,d.Headers=e,d.Request=m,d.Response=C),E.Headers=e,E.Request=m,E.Response=C,E.fetch=L,Object.defineProperty(E,"__esModule",{value:!0}),E})({})})(typeof self<"u"?self:Le)}()),Le}var De={},Ge;function Re(){return Ge||(Ge=1,function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.ERROR_CODES=d.ErrorCoded=void 0;class E extends Error{constructor(g,f){super(g),this.code=f}}d.ErrorCoded=E,function(a){a.COLLIDING_KEYWORDS="colliding keywords",a.CONFLICTING_INDEXES="conflicting indexes",a.CYCLIC_IRI_MAPPING="cyclic IRI mapping",a.INVALID_ID_VALUE="invalid @id value",a.INVALID_INDEX_VALUE="invalid @index value",a.INVALID_NEST_VALUE="invalid @nest value",a.INVALID_PREFIX_VALUE="invalid @prefix value",a.INVALID_PROPAGATE_VALUE="invalid @propagate value",a.INVALID_REVERSE_VALUE="invalid @reverse value",a.INVALID_IMPORT_VALUE="invalid @import value",a.INVALID_VERSION_VALUE="invalid @version value",a.INVALID_BASE_IRI="invalid base IRI",a.INVALID_CONTAINER_MAPPING="invalid container mapping",a.INVALID_CONTEXT_ENTRY="invalid context entry",a.INVALID_CONTEXT_NULLIFICATION="invalid context nullification",a.INVALID_DEFAULT_LANGUAGE="invalid default language",a.INVALID_INCLUDED_VALUE="invalid @included value",a.INVALID_IRI_MAPPING="invalid IRI mapping",a.INVALID_JSON_LITERAL="invalid JSON literal",a.INVALID_KEYWORD_ALIAS="invalid keyword alias",a.INVALID_LANGUAGE_MAP_VALUE="invalid language map value",a.INVALID_LANGUAGE_MAPPING="invalid language mapping",a.INVALID_LANGUAGE_TAGGED_STRING="invalid language-tagged string",a.INVALID_LANGUAGE_TAGGED_VALUE="invalid language-tagged value",a.INVALID_LOCAL_CONTEXT="invalid local context",a.INVALID_REMOTE_CONTEXT="invalid remote context",a.INVALID_REVERSE_PROPERTY="invalid reverse property",a.INVALID_REVERSE_PROPERTY_MAP="invalid reverse property map",a.INVALID_REVERSE_PROPERTY_VALUE="invalid reverse property value",a.INVALID_SCOPED_CONTEXT="invalid scoped context",a.INVALID_SCRIPT_ELEMENT="invalid script element",a.INVALID_SET_OR_LIST_OBJECT="invalid set or list object",a.INVALID_TERM_DEFINITION="invalid term definition",a.INVALID_TYPE_MAPPING="invalid type mapping",a.INVALID_TYPE_VALUE="invalid type value",a.INVALID_TYPED_VALUE="invalid typed value",a.INVALID_VALUE_OBJECT="invalid value object",a.INVALID_VALUE_OBJECT_VALUE="invalid value object value",a.INVALID_VOCAB_MAPPING="invalid vocab mapping",a.IRI_CONFUSED_WITH_PREFIX="IRI confused with prefix",a.KEYWORD_REDEFINITION="keyword redefinition",a.LOADING_DOCUMENT_FAILED="loading document failed",a.LOADING_REMOTE_CONTEXT_FAILED="loading remote context failed",a.MULTIPLE_CONTEXT_LINK_HEADERS="multiple context link headers",a.PROCESSING_MODE_CONFLICT="processing mode conflict",a.PROTECTED_TERM_REDEFINITION="protected term redefinition",a.CONTEXT_OVERFLOW="context overflow",a.INVALID_BASE_DIRECTION="invalid base direction",a.RECURSIVE_CONTEXT_INCLUSION="recursive context inclusion",a.INVALID_STREAMING_KEY_ORDER="invalid streaming key order",a.INVALID_EMBEDDED_NODE="invalid embedded node",a.INVALID_ANNOTATION="invalid annotation"}(d.ERROR_CODES||(d.ERROR_CODES={}))}(De)),De}var Q={},Pe,$e;function bt(){if($e)return Pe;$e=1;var d=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,E=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,a=/\s|\uFEFF|\xA0/,g=/\r?\n[\x20\x09]+/g,f=/[;,"]/,c=/[;,"]|\s/,t=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/,r={IDLE:1,URI:2,ATTR:4};function n(u){return u.replace(E,"")}function e(u){return a.test(u)}function l(u,h){for(;e(u[h]);)h++;return h}function o(u){return c.test(u)||!t.test(u)}class s{constructor(h){this.refs=[],h&&this.parse(h)}rel(h){for(var p=[],b=h.toLowerCase(),O=0;O<this.refs.length;O++)this.refs[O].rel.toLowerCase()===b&&p.push(this.refs[O]);return p}get(h,p){h=h.toLowerCase();for(var b=[],O=0;O<this.refs.length;O++)this.refs[O][h]===p&&b.push(this.refs[O]);return b}set(h){return this.refs.push(h),this}has(h,p){h=h.toLowerCase();for(var b=0;b<this.refs.length;b++)if(this.refs[b][h]===p)return!0;return!1}parse(h,x){x=x||0,h=x?h.slice(x):h,h=n(h).replace(g,"");for(var b=r.IDLE,O=h.length,x=0,m=null;x<O;)if(b===r.IDLE){if(e(h[x])){x++;continue}else if(h[x]==="<"){m!=null&&(m.rel!=null?this.refs.push(...s.expandRelations(m)):this.refs.push(m));var A=h.indexOf(">",x);if(A===-1)throw new Error("Expected end of URI delimiter at offset "+x);m={uri:h.slice(x+1,A)},x=A,b=r.URI}else throw new Error('Unexpected character "'+h[x]+'" at offset '+x);x++}else if(b===r.URI)if(e(h[x])){x++;continue}else if(h[x]===";")b=r.ATTR,x++;else if(h[x]===",")b=r.IDLE,x++;else throw new Error('Unexpected character "'+h[x]+'" at offset '+x);else if(b===r.ATTR){if(h[x]===";"||e(h[x])){x++;continue}var A=h.indexOf("=",x);if(A===-1)throw new Error("Expected attribute delimiter at offset "+x);var w=n(h.slice(x,A)).toLowerCase(),C="";if(x=A+1,x=l(h,x),h[x]==='"')for(x++;x<O;){if(h[x]==='"'){x++;break}h[x]==="\\"&&x++,C+=h[x],x++}else{for(var A=x+1;!f.test(h[A])&&A<O;)A++;C=h.slice(x,A),x=A}switch(m[w]&&s.isSingleOccurenceAttr(w)||(w[w.length-1]==="*"?m[w]=s.parseExtendedValue(C):(C=w==="type"?C.toLowerCase():C,m[w]!=null?Array.isArray(m[w])?m[w].push(C):m[w]=[m[w],C]:m[w]=C)),h[x]){case",":b=r.IDLE;break;case";":b=r.ATTR;break}x++}else throw new Error('Unknown parser state "'+b+'"');return m!=null&&(m.rel!=null?this.refs.push(...s.expandRelations(m)):this.refs.push(m)),m=null,this}toString(){for(var h=[],p="",b=null,O=0;O<this.refs.length;O++)b=this.refs[O],p=Object.keys(this.refs[O]).reduce(function(x,m){return m==="uri"?x:x+"; "+s.formatAttribute(m,b[m])},"<"+b.uri+">"),h.push(p);return h.join(", ")}}return s.isCompatibleEncoding=function(u){return d.test(u)},s.parse=function(u,h){return new s().parse(u,h)},s.isSingleOccurenceAttr=function(u){return u==="rel"||u==="type"||u==="media"||u==="title"||u==="title*"},s.isTokenAttr=function(u){return u==="rel"||u==="type"||u==="anchor"},s.escapeQuotes=function(u){return u.replace(/"/g,'\\"')},s.expandRelations=function(u){var h=u.rel.split(" ");return h.map(function(p){var b=Object.assign({},u);return b.rel=p,b})},s.parseExtendedValue=function(u){var h=/([^']+)?(?:'([^']*)')?(.+)/.exec(u);return{language:h[2].toLowerCase(),encoding:s.isCompatibleEncoding(h[1])?null:h[1].toLowerCase(),value:s.isCompatibleEncoding(h[1])?decodeURIComponent(h[3]):h[3]}},s.formatExtendedAttribute=function(u,h){var p=(h.encoding||"utf-8").toUpperCase(),b=h.language||"en",O="";return Buffer.isBuffer(h.value)&&s.isCompatibleEncoding(p)?O=h.value.toString(p):Buffer.isBuffer(h.value)?O=h.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):O=encodeURIComponent(h.value),u+"="+p+"'"+b+"'"+O},s.formatAttribute=function(u,h){return Array.isArray(h)?h.map(p=>s.formatAttribute(u,p)).join("; "):u[u.length-1]==="*"||typeof h!="string"?s.formatExtendedAttribute(u,h):(s.isTokenAttr(u)?h=o(h)?'"'+s.escapeQuotes(h)+'"':s.escapeQuotes(h):o(h)&&(h=encodeURIComponent(h),h=h.replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"),h='"'+h+'"'),u+"="+h)},Pe=s,Pe}var Je;function xt(){if(Je)return Q;Je=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.FetchDocumentLoader=void 0,Rt();const d=Re(),E=bt(),a=Fe();let g=class{constructor(c){this.fetcher=c}async load(c){const t=await(this.fetcher||fetch)(c,{headers:new Headers({accept:"application/ld+json"})});if(t.ok&&t.headers){let r=t.headers.get("Content-Type");if(r){const n=r.indexOf(";");n>0&&(r=r.substr(0,n))}if(r==="application/ld+json")return await t.json();if(t.headers.has("Link")){let n;if(t.headers.forEach((e,l)=>{if(l==="link"){const o=(0,E.parse)(e);for(const s of o.get("type","application/ld+json"))if(s.rel==="alternate"){if(n)throw new Error("Multiple JSON-LD alternate links were found on "+c);n=(0,a.resolve)(s.uri,c)}}}),n)return this.load(n)}throw new d.ErrorCoded(`Unsupported JSON-LD media type ${r}`,d.ERROR_CODES.LOADING_DOCUMENT_FAILED)}else throw new Error(t.statusText||`Status code: ${t.status}`)}};return Q.FetchDocumentLoader=g,Q}var Z={},ee={},Me;function je(){if(Me)return ee;Me=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.Util=void 0;class d{static isCompactIri(a){return a.indexOf(":")>0&&!(a&&a[0]==="#")}static getPrefix(a,g){if(a&&a[0]==="#")return null;const f=a.indexOf(":");if(f>=0){if(a.length>f+1&&a.charAt(f+1)==="/"&&a.charAt(f+2)==="/")return null;const c=a.substr(0,f);if(c==="_")return null;if(g[c])return c}return null}static getContextValueId(a){if(a===null||typeof a=="string")return a;const g=a["@id"];return g||null}static isSimpleTermDefinitionPrefix(a,g){return!d.isPotentialKeyword(a)&&(a[0]==="_"||g.allowPrefixNonGenDelims||d.isPrefixIriEndingWithGenDelim(a))}static isPotentialKeyword(a){return typeof a=="string"&&d.KEYWORD_REGEX.test(a)}static isPrefixIriEndingWithGenDelim(a){return d.ENDS_WITH_GEN_DELIM.test(a)}static isPrefixValue(a){return a&&(typeof a=="string"||a&&typeof a=="object")}static isValidIri(a){return!!(a&&d.IRI_REGEX.test(a))}static isValidIriWeak(a){return!!a&&a[0]!==":"&&d.IRI_REGEX_WEAK.test(a)}static isValidKeyword(a){return d.VALID_KEYWORDS[a]}static isTermProtected(a,g){const f=a[g];return typeof f!="string"&&f&&f["@protected"]}static hasProtectedTerms(a){for(const g of Object.keys(a))if(d.isTermProtected(a,g))return!0;return!1}static isReservedInternalKeyword(a){return a.startsWith("@__")}}return ee.Util=d,d.IRI_REGEX=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^ "<>{}|\\\[\]`#]*(#[^#]*)?$/,d.IRI_REGEX_WEAK=/(?::[^:])|\//,d.KEYWORD_REGEX=/^@[a-z]+$/i,d.ENDS_WITH_GEN_DELIM=/[:/?#\[\]@]$/,d.REGEX_LANGUAGE_TAG=/^[a-zA-Z]+(-[a-zA-Z0-9]+)*$/,d.REGEX_DIRECTION_TAG=/^(ltr)|(rtl)$/,d.VALID_KEYWORDS={"@annotation":!0,"@base":!0,"@container":!0,"@context":!0,"@direction":!0,"@graph":!0,"@id":!0,"@import":!0,"@included":!0,"@index":!0,"@json":!0,"@language":!0,"@list":!0,"@nest":!0,"@none":!0,"@prefix":!0,"@propagate":!0,"@protected":!0,"@reverse":!0,"@set":!0,"@type":!0,"@value":!0,"@version":!0,"@vocab":!0},d.EXPAND_KEYS_BLACKLIST=["@base","@vocab","@language","@version","@direction"],d.ALIAS_DOMAIN_BLACKLIST=["@container","@graph","@id","@index","@list","@nest","@none","@prefix","@reverse","@set","@type","@value","@version"],d.ALIAS_RANGE_BLACKLIST=["@context","@preserve"],d.CONTAINERS=["@list","@set","@index","@language","@graph","@id","@type"],d.CONTAINERS_1_0=["@list","@set","@index"],ee}var qe;function Ot(){if(qe)return Z;qe=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.JsonLdContextNormalized=void 0;const d=Fe(),E=mt(),a=Re(),g=je();let f=class{constructor(t){this.contextRaw=t}getContextRaw(){return this.contextRaw}expandTerm(t,r,n=E.defaultExpandOptions){const e=this.contextRaw[t];if(e===null||e&&e["@id"]===null)return null;let l=!0;if(e&&r){const b=g.Util.getContextValueId(e);if(b&&b!==t)if(typeof b!="string"||!g.Util.isValidIri(b)&&!g.Util.isValidKeyword(b))g.Util.isPotentialKeyword(b)||(l=!1);else return b}const o=g.Util.getPrefix(t,this.contextRaw),s=this.contextRaw["@vocab"],u=(!!s||s==="")&&s.indexOf(":")<0,h=this.contextRaw["@base"],p=g.Util.isPotentialKeyword(t);if(o){const b=this.contextRaw[o],O=g.Util.getContextValueId(b);if(O){if(typeof b=="string"||!n.allowPrefixForcing){if(!g.Util.isSimpleTermDefinitionPrefix(O,n))return t}else if(O[0]!=="_"&&!p&&!b["@prefix"]&&!(t in this.contextRaw))return t;return O+t.substr(o.length+1)}}else if(r&&(s||s===""||n.allowVocabRelativeToBase&&h&&u)&&!p&&!g.Util.isCompactIri(t))if(u){if(n.allowVocabRelativeToBase)return(s||h?(0,d.resolve)(s,h):"")+t;throw new a.ErrorCoded(`Relative vocab expansion for term '${t}' with vocab '${s}' is not allowed.`,a.ERROR_CODES.INVALID_VOCAB_MAPPING)}else return s+t;else if(!r&&h&&!p&&!g.Util.isCompactIri(t))return(0,d.resolve)(t,h);if(l)return t;throw new a.ErrorCoded(`Invalid IRI mapping found for context entry '${t}': '${JSON.stringify(e)}'`,a.ERROR_CODES.INVALID_IRI_MAPPING)}compactIri(t,r){if(r&&this.contextRaw["@vocab"]&&t.startsWith(this.contextRaw["@vocab"]))return t.substr(this.contextRaw["@vocab"].length);if(!r&&this.contextRaw["@base"]&&t.startsWith(this.contextRaw["@base"]))return t.substr(this.contextRaw["@base"].length);const n={prefix:"",suffix:t};for(const e in this.contextRaw){const l=this.contextRaw[e];if(l&&!g.Util.isPotentialKeyword(e)){const o=g.Util.getContextValueId(l);if(t.startsWith(o)){const s=t.substr(o.length);if(s)s.length<n.suffix.length&&(n.prefix=e,n.suffix=s);else if(r)return e}}}return n.prefix?n.prefix+":"+n.suffix:t}};return Z.JsonLdContextNormalized=f,Z}var Xe;function mt(){return Xe||(Xe=1,function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.defaultExpandOptions=d.ContextParser=void 0,Rt();const E=Fe(),a=Re(),g=xt(),f=Ot(),c=je(),t=_t();class r{constructor(e){e=e||{},this.documentLoader=e.documentLoader||new g.FetchDocumentLoader,this.documentCache={},this.validateContext=!e.skipValidation,this.expandContentTypeToBase=!!e.expandContentTypeToBase,this.remoteContextsDepthLimit=e.remoteContextsDepthLimit||32,this.redirectSchemaOrgHttps="redirectSchemaOrgHttps"in e?!!e.redirectSchemaOrgHttps:!0}static validateLanguage(e,l,o){if(typeof e!="string")throw new a.ErrorCoded(`The value of an '@language' must be a string, got '${JSON.stringify(e)}'`,o);if(!c.Util.REGEX_LANGUAGE_TAG.test(e)){if(l)throw new a.ErrorCoded(`The value of an '@language' must be a valid language tag, got '${JSON.stringify(e)}'`,o);return!1}return!0}static validateDirection(e,l){if(typeof e!="string")throw new a.ErrorCoded(`The value of an '@direction' must be a string, got '${JSON.stringify(e)}'`,a.ERROR_CODES.INVALID_BASE_DIRECTION);if(!c.Util.REGEX_DIRECTION_TAG.test(e)){if(l)throw new a.ErrorCoded(`The value of an '@direction' must be 'ltr' or 'rtl', got '${JSON.stringify(e)}'`,a.ERROR_CODES.INVALID_BASE_DIRECTION);return!1}return!0}idifyReverseTerms(e){for(const l of Object.keys(e)){const o=e[l];if(o&&typeof o=="object"&&o["@reverse"]&&!o["@id"]){if(typeof o["@reverse"]!="string"||c.Util.isValidKeyword(o["@reverse"]))throw new a.ErrorCoded(`Invalid @reverse value, must be absolute IRI or blank node: '${o["@reverse"]}'`,a.ERROR_CODES.INVALID_IRI_MAPPING);o["@id"]=o["@reverse"],c.Util.isPotentialKeyword(o["@reverse"])?delete o["@reverse"]:o["@reverse"]=!0}}return e}expandPrefixedTerms(e,l){const o=e.getContextRaw();for(const s of Object.keys(o))if(c.Util.EXPAND_KEYS_BLACKLIST.indexOf(s)<0&&!c.Util.isReservedInternalKeyword(s)){const u=o[s];if(c.Util.isPotentialKeyword(s)&&c.Util.ALIAS_DOMAIN_BLACKLIST.indexOf(s)>=0&&(s!=="@type"||typeof o[s]=="object"&&!(o[s]["@protected"]||o[s]["@container"]==="@set")))throw new a.ErrorCoded(`Keywords can not be aliased to something else.
Tried mapping ${s} to ${JSON.stringify(u)}`,a.ERROR_CODES.KEYWORD_REDEFINITION);if(c.Util.ALIAS_RANGE_BLACKLIST.indexOf(c.Util.getContextValueId(u))>=0)throw new a.ErrorCoded(`Aliasing to certain keywords is not allowed.
Tried mapping ${s} to ${JSON.stringify(u)}`,a.ERROR_CODES.INVALID_KEYWORD_ALIAS);if(u&&c.Util.isPotentialKeyword(c.Util.getContextValueId(u))&&u["@prefix"]===!0)throw new a.ErrorCoded(`Tried to use keyword aliases as prefix: '${s}': '${JSON.stringify(u)}'`,a.ERROR_CODES.INVALID_TERM_DEFINITION);for(;c.Util.isPrefixValue(o[s]);){const h=o[s];let p=!1;if(typeof h=="string")o[s]=e.expandTerm(h,!0),p=p||h!==o[s];else{const b=h["@id"],O=h["@type"],x=!("@prefix"in h)||c.Util.isValidIri(s);if("@id"in h)b!=null&&typeof b=="string"&&(o[s]["@id"]=e.expandTerm(b,!0),p=p||b!==o[s]["@id"]);else if(!c.Util.isPotentialKeyword(s)&&x){const m=e.expandTerm(s,!0);m!==s&&(o[s]["@id"]=m,p=!0)}O&&typeof O=="string"&&O!=="@vocab"&&(!h["@container"]||!h["@container"]["@type"])&&x&&(o[s]["@type"]=e.expandTerm(O,!0),l&&O===o[s]["@type"]&&(o[s]["@type"]=e.expandTerm(O,!1)),p=p||O!==o[s]["@type"])}if(!p)break}}}normalize(e,{processingMode:l,normalizeLanguageTags:o}){if(o||l===1)for(const s of Object.keys(e))if(s==="@language"&&typeof e[s]=="string")e[s]=e[s].toLowerCase();else{const u=e[s];u&&typeof u=="object"&&typeof u["@language"]=="string"&&(u["@language"]=u["@language"].toLowerCase())}}containersToHash(e){for(const l of Object.keys(e)){const o=e[l];if(o&&typeof o=="object"){if(typeof o["@container"]=="string")o["@container"]={[o["@container"]]:!0};else if(Array.isArray(o["@container"])){const s={};for(const u of o["@container"])s[u]=!0;o["@container"]=s}}}}applyScopedProtected(e,{processingMode:l}){if(l&&l>=1.1&&e["@protected"]){for(const o of Object.keys(e))if(!c.Util.isReservedInternalKeyword(o)&&!c.Util.isPotentialKeyword(o)&&!c.Util.isTermProtected(e,o)){const s=e[o];s&&typeof s=="object"?"@protected"in e[o]||(e[o]["@protected"]=!0):e[o]={"@id":s,"@protected":!0}}delete e["@protected"]}}validateKeywordRedefinitions(e,l,o){for(const s of Object.keys(l))if(c.Util.isTermProtected(e,s)){if(typeof l[s]=="string"){const p=c.Util.isSimpleTermDefinitionPrefix(l[s],o);l[s]={"@id":l[s]},p&&(l[s]["@prefix"]=!0,e[s]["@prefix"]=!0)}const u=t(e[s]);l[s]["@protected"]=!0;const h=t(l[s]);if(u!==h)throw new a.ErrorCoded(`Attempted to override the protected keyword ${s} from ${JSON.stringify(c.Util.getContextValueId(e[s]))} to ${JSON.stringify(c.Util.getContextValueId(l[s]))}`,a.ERROR_CODES.PROTECTED_TERM_REDEFINITION)}}validate(e,{processingMode:l}){for(const o of Object.keys(e)){if(c.Util.isReservedInternalKeyword(o))continue;if(o==="")throw new a.ErrorCoded(`The empty term is not allowed, got: '${o}': '${JSON.stringify(e[o])}'`,a.ERROR_CODES.INVALID_TERM_DEFINITION);const s=e[o],u=typeof s;if(c.Util.isPotentialKeyword(o)){switch(o.substr(1)){case"vocab":if(s!==null&&u!=="string")throw new a.ErrorCoded(`Found an invalid @vocab IRI: ${s}`,a.ERROR_CODES.INVALID_VOCAB_MAPPING);break;case"base":if(s!==null&&u!=="string")throw new a.ErrorCoded(`Found an invalid @base IRI: ${e[o]}`,a.ERROR_CODES.INVALID_BASE_IRI);break;case"language":s!==null&&r.validateLanguage(s,!0,a.ERROR_CODES.INVALID_DEFAULT_LANGUAGE);break;case"version":if(s!==null&&u!=="number")throw new a.ErrorCoded(`Found an invalid @version number: ${s}`,a.ERROR_CODES.INVALID_VERSION_VALUE);break;case"direction":s!==null&&r.validateDirection(s,!0);break;case"propagate":if(l===1)throw new a.ErrorCoded(`Found an illegal @propagate keyword: ${s}`,a.ERROR_CODES.INVALID_CONTEXT_ENTRY);if(s!==null&&u!=="boolean")throw new a.ErrorCoded(`Found an invalid @propagate value: ${s}`,a.ERROR_CODES.INVALID_PROPAGATE_VALUE);break}if(c.Util.isValidKeyword(o)&&c.Util.isValidKeyword(c.Util.getContextValueId(s)))throw new a.ErrorCoded(`Illegal keyword alias in term value, found: '${o}': '${c.Util.getContextValueId(s)}'`,a.ERROR_CODES.KEYWORD_REDEFINITION);continue}if(s!==null)switch(u){case"string":if(c.Util.getPrefix(s,e)===o)throw new a.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.CYCLIC_IRI_MAPPING);if(c.Util.isValidIriWeak(o)){if(s==="@type")throw new a.ErrorCoded(`IRIs can not be mapped to @type, found: '${o}': '${s}'`,a.ERROR_CODES.INVALID_IRI_MAPPING);if(c.Util.isValidIri(s)&&s!==new f.JsonLdContextNormalized(e).expandTerm(o))throw new a.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${o}': '${s}'`,a.ERROR_CODES.INVALID_IRI_MAPPING)}break;case"object":if(!c.Util.isCompactIri(o)&&!("@id"in s)&&(s["@type"]==="@id"?!e["@base"]:!e["@vocab"]))throw new a.ErrorCoded(`Missing @id in context entry: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_IRI_MAPPING);for(const h of Object.keys(s)){const p=s[h];if(p)switch(h){case"@id":if(c.Util.isValidKeyword(p)&&p!=="@type"&&p!=="@id"&&p!=="@graph"&&p!=="@nest")throw new a.ErrorCoded(`Illegal keyword alias in term value, found: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_IRI_MAPPING);if(c.Util.isValidIriWeak(o)){if(p==="@type")throw new a.ErrorCoded(`IRIs can not be mapped to @type, found: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_IRI_MAPPING);if(c.Util.isValidIri(p)&&p!==new f.JsonLdContextNormalized(e).expandTerm(o))throw new a.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_IRI_MAPPING)}if(typeof p!="string")throw new a.ErrorCoded(`Detected non-string @id in context entry: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_IRI_MAPPING);if(c.Util.getPrefix(p,e)===o)throw new a.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.CYCLIC_IRI_MAPPING);break;case"@type":if(s["@container"]==="@type"&&p!=="@id"&&p!=="@vocab")throw new a.ErrorCoded(`@container: @type only allows @type: @id or @vocab, but got: '${o}': '${p}'`,a.ERROR_CODES.INVALID_TYPE_MAPPING);if(typeof p!="string")throw new a.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(u)}'`,a.ERROR_CODES.INVALID_TYPE_MAPPING);if(p!=="@id"&&p!=="@vocab"&&(l===1||p!=="@json")&&(l===1||p!=="@none")&&(p[0]==="_"||!c.Util.isValidIri(p)))throw new a.ErrorCoded(`A context @type must be an absolute IRI, found: '${o}': '${p}'`,a.ERROR_CODES.INVALID_TYPE_MAPPING);break;case"@reverse":if(typeof p=="string"&&s["@id"]&&s["@id"]!==p)throw new a.ErrorCoded(`Found non-matching @id and @reverse term values in '${o}':'${p}' and '${s["@id"]}'`,a.ERROR_CODES.INVALID_REVERSE_PROPERTY);if("@nest"in s)throw new a.ErrorCoded(`@nest is not allowed in the reverse property '${o}'`,a.ERROR_CODES.INVALID_REVERSE_PROPERTY);break;case"@container":if(l===1&&(Object.keys(p).length>1||c.Util.CONTAINERS_1_0.indexOf(Object.keys(p)[0])<0))throw new a.ErrorCoded(`Invalid term @container for '${o}' ('${Object.keys(p)}') in 1.0, must be only one of ${c.Util.CONTAINERS_1_0.join(", ")}`,a.ERROR_CODES.INVALID_CONTAINER_MAPPING);for(const b of Object.keys(p)){if(b==="@list"&&s["@reverse"])throw new a.ErrorCoded(`Term value can not be @container: @list and @reverse at the same time on '${o}'`,a.ERROR_CODES.INVALID_REVERSE_PROPERTY);if(c.Util.CONTAINERS.indexOf(b)<0)throw new a.ErrorCoded(`Invalid term @container for '${o}' ('${b}'), must be one of ${c.Util.CONTAINERS.join(", ")}`,a.ERROR_CODES.INVALID_CONTAINER_MAPPING)}break;case"@language":r.validateLanguage(p,!0,a.ERROR_CODES.INVALID_LANGUAGE_MAPPING);break;case"@direction":r.validateDirection(p,!0);break;case"@prefix":if(p!==null&&typeof p!="boolean")throw new a.ErrorCoded(`Found an invalid term @prefix boolean in: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_PREFIX_VALUE);if(!("@id"in s)&&!c.Util.isValidIri(o))throw new a.ErrorCoded(`Invalid @prefix definition for '${o}' ('${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@index":if(l===1||!s["@container"]||!s["@container"]["@index"])throw new a.ErrorCoded(`Attempt to add illegal key to value object: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@nest":if(c.Util.isPotentialKeyword(p)&&p!=="@nest")throw new a.ErrorCoded(`Found an invalid term @nest value in: '${o}': '${JSON.stringify(s)}'`,a.ERROR_CODES.INVALID_NEST_VALUE)}}break;default:throw new a.ErrorCoded(`Found an invalid term value: '${o}': '${s}'`,a.ERROR_CODES.INVALID_TERM_DEFINITION)}}}applyBaseEntry(e,l,o){return typeof e=="string"||(o&&!("@base"in e)&&l.parentContext&&typeof l.parentContext=="object"&&"@base"in l.parentContext&&(e["@base"]=l.parentContext["@base"],l.parentContext["@__baseDocument"]&&(e["@__baseDocument"]=!0)),l.baseIRI&&!l.external&&("@base"in e?e["@base"]!==null&&typeof e["@base"]=="string"&&!c.Util.isValidIri(e["@base"])&&(e["@base"]=(0,E.resolve)(e["@base"],l.parentContext&&l.parentContext["@base"]||l.baseIRI)):(e["@base"]=l.baseIRI,e["@__baseDocument"]=!0))),e}normalizeContextIri(e,l){if(!c.Util.isValidIri(e))try{e=(0,E.resolve)(e,l)}catch{throw new Error(`Invalid context IRI: ${e}`)}return this.redirectSchemaOrgHttps&&e.startsWith("http://schema.org")&&(e="https://schema.org/"),e}async parseInnerContexts(e,l){for(const o of Object.keys(e)){const s=e[o];if(s&&typeof s=="object"&&"@context"in s&&s["@context"]!==null&&!l.ignoreScopedContexts){if(this.validateContext)try{const u=Object.assign({},e);u[o]=Object.assign({},u[o]),delete u[o]["@context"],await this.parse(s["@context"],Object.assign(Object.assign({},l),{external:!1,parentContext:u,ignoreProtection:!0,ignoreRemoteScopedContexts:!0,ignoreScopedContexts:!0}))}catch(u){throw new a.ErrorCoded(u.message,a.ERROR_CODES.INVALID_SCOPED_CONTEXT)}s["@context"]=(await this.parse(s["@context"],Object.assign(Object.assign({},l),{external:!1,minimalProcessing:!0,ignoreRemoteScopedContexts:!0,parentContext:e}))).getContextRaw()}}return e}async parse(e,l={}){const{baseIRI:o,parentContext:s,external:u,processingMode:h=r.DEFAULT_PROCESSING_MODE,normalizeLanguageTags:p,ignoreProtection:b,minimalProcessing:O}=l;let x=s;const m=l.remoteContexts||{};if(Object.keys(m).length>=this.remoteContextsDepthLimit)throw new a.ErrorCoded("Detected an overflow in remote context inclusions: "+Object.keys(m),a.ERROR_CODES.CONTEXT_OVERFLOW);if(e==null){if(!b&&x&&c.Util.hasProtectedTerms(x))throw new a.ErrorCoded("Illegal context nullification when terms are protected",a.ERROR_CODES.INVALID_CONTEXT_NULLIFICATION);return new f.JsonLdContextNormalized(this.applyBaseEntry({},l,!1))}else if(typeof e=="string"){const A=this.normalizeContextIri(e,o),w=this.getOverriddenLoad(A,l);if(w)return new f.JsonLdContextNormalized(w);const C=await this.parse(await this.load(A),Object.assign(Object.assign({},l),{baseIRI:A,external:!0,remoteContexts:Object.assign(Object.assign({},m),{[A]:!0})}));return this.applyBaseEntry(C.getContextRaw(),l,!0),C}else if(Array.isArray(e)){const A=[],w=await Promise.all(e.map((S,L)=>{if(typeof S=="string"){const y=this.normalizeContextIri(S,o);A[L]=y;const I=this.getOverriddenLoad(y,l);return I||this.load(y)}else return S}));if(O)return new f.JsonLdContextNormalized(w);const C=await w.reduce((S,L,y)=>S.then(I=>this.parse(L,Object.assign(Object.assign({},l),{baseIRI:A[y]||l.baseIRI,external:!!A[y]||l.external,parentContext:I.getContextRaw(),remoteContexts:A[y]?Object.assign(Object.assign({},m),{[A[y]]:!0}):m}))),Promise.resolve(new f.JsonLdContextNormalized(x||{})));return this.applyBaseEntry(C.getContextRaw(),l,!0),C}else if(typeof e=="object"){if("@context"in e)return await this.parse(e["@context"],l);e=JSON.parse(JSON.stringify(e)),x&&!O&&(x=JSON.parse(JSON.stringify(x)));let A={};if(u&&delete e["@base"],this.applyBaseEntry(e,l,!0),this.containersToHash(e),O)return new f.JsonLdContextNormalized(e);let w={};if("@import"in e)if(h>=1.1){if(typeof e["@import"]!="string")throw new a.ErrorCoded("An @import value must be a string, but got "+typeof e["@import"],a.ERROR_CODES.INVALID_IMPORT_VALUE);w=await this.loadImportContext(this.normalizeContextIri(e["@import"],o)),delete e["@import"]}else throw new a.ErrorCoded("Context importing is not supported in JSON-LD 1.0",a.ERROR_CODES.INVALID_CONTEXT_ENTRY);A=Object.assign(Object.assign(Object.assign(Object.assign({},A),typeof x=="object"?x:{}),w),e);const C=new f.JsonLdContextNormalized(A);return await this.parseInnerContexts(A,l),(A&&A["@version"]||r.DEFAULT_PROCESSING_MODE)>=1.1&&(e["@vocab"]&&typeof e["@vocab"]=="string"||e["@vocab"]==="")&&(x&&"@vocab"in x&&e["@vocab"].indexOf(":")<0?A["@vocab"]=x["@vocab"]+e["@vocab"]:(c.Util.isCompactIri(e["@vocab"])||e["@vocab"]in C.getContextRaw())&&(A["@vocab"]=C.expandTerm(e["@vocab"],!0))),this.idifyReverseTerms(A),this.expandPrefixedTerms(C,this.expandContentTypeToBase),!b&&x&&h>=1.1&&this.validateKeywordRedefinitions(x,A,d.defaultExpandOptions),this.normalize(A,{processingMode:h,normalizeLanguageTags:p}),this.applyScopedProtected(A,{processingMode:h}),this.validateContext&&this.validate(A,{processingMode:h}),C}else throw new a.ErrorCoded(`Tried parsing a context that is not a string, array or object, but got ${e}`,a.ERROR_CODES.INVALID_LOCAL_CONTEXT)}async load(e){const l=this.documentCache[e];if(l)return typeof l=="string"?l:Array.isArray(l)?l.slice():Object.assign({},l);let o;try{o=await this.documentLoader.load(e)}catch(s){throw new a.ErrorCoded(`Failed to load remote context ${e}: ${s.message}`,a.ERROR_CODES.LOADING_REMOTE_CONTEXT_FAILED)}if(!("@context"in o))throw new a.ErrorCoded(`Missing @context in remote context at ${e}`,a.ERROR_CODES.INVALID_REMOTE_CONTEXT);return this.documentCache[e]=o["@context"]}getOverriddenLoad(e,l){if(e in(l.remoteContexts||{})){if(l.ignoreRemoteScopedContexts)return e;throw new a.ErrorCoded("Detected a cyclic context inclusion of "+e,a.ERROR_CODES.RECURSIVE_CONTEXT_INCLUSION)}return null}async loadImportContext(e){const l=await this.load(e);if(typeof l!="object"||Array.isArray(l))throw new a.ErrorCoded("An imported context must be a single object: "+e,a.ERROR_CODES.INVALID_REMOTE_CONTEXT);if("@import"in l)throw new a.ErrorCoded("An imported context can not import another context: "+e,a.ERROR_CODES.INVALID_CONTEXT_ENTRY);return this.containersToHash(l),l}}d.ContextParser=r,r.DEFAULT_PROCESSING_MODE=1.1,d.defaultExpandOptions={allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}}(ve)),ve}var Ve={},We;function Xt(){return We||(We=1,Object.defineProperty(Ve,"__esModule",{value:!0})),Ve}var Ue={},Ye;function Wt(){return Ye||(Ye=1,Object.defineProperty(Ue,"__esModule",{value:!0})),Ue}var ze;function F(){return ze||(ze=1,function(d){var E=X&&X.__createBinding||(Object.create?function(g,f,c,t){t===void 0&&(t=c);var r=Object.getOwnPropertyDescriptor(f,c);(!r||("get"in r?!f.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return f[c]}}),Object.defineProperty(g,t,r)}:function(g,f,c,t){t===void 0&&(t=c),g[t]=f[c]}),a=X&&X.__exportStar||function(g,f){for(var c in g)c!=="default"&&!Object.prototype.hasOwnProperty.call(f,c)&&E(f,g,c)};Object.defineProperty(d,"__esModule",{value:!0}),a(mt(),d),a(Re(),d),a(xt(),d),a(Xt(),d),a(Wt(),d),a(Ot(),d),a(je(),d)}(X)),X}var te={},re={},ne={},ie={},Qe;function Yt(){if(Qe)return ie;Qe=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.ContainerHandlerIdentifier=void 0;let d=class{canCombineWithGraph(){return!0}async handle(a,g,f,c,t,r){let n;if(g.emittedStack[r+1]&&g.idStack[r+1])n=g.idStack[r+1][0];else{const o=await f.getContainerKey(c[r],c,r)!==null?await f.resourceToTerm(await g.getContext(c),c[r]):f.dataFactory.blankNode();if(!o){g.emittedStack[r]=!1;return}n=o,g.idStack[r+1]=[n]}let e=g.idStack[r];e||(e=g.idStack[r]=[]),e.some(l=>l.equals(n))||e.push(n),await g.handlePendingContainerFlushBuffers()||(g.emittedStack[r]=!1)}};return ie.ContainerHandlerIdentifier=d,ie}var ae={},se={},Ze;function Se(){if(Ze)return se;Ze=1,Object.defineProperty(se,"__esModule",{value:!0}),se.EntryHandlerPredicate=void 0;const d=F(),E=W();let a=class St{static async handlePredicateObject(f,c,t,r,n,e,l,o,s){const u=await c.getPropertiesDepth(t,r),h=await c.getDepthOffsetGraph(r,t),p=r-h,b=f.idStack[u];if(b&&!s)for(const O of b)if(h>=0){const m=f.idStack[p-1];if(m)for(const A of m)c.emitQuadChecked(r,O,n,e,A,l,o);else l?(c.validateReverseSubject(e),f.getUnidentifiedGraphBufferSafe(p-1).push({subject:e,predicate:n,object:O,isEmbedded:o})):f.getUnidentifiedGraphBufferSafe(p-1).push({subject:O,predicate:n,object:e,isEmbedded:o})}else{const m=await c.getGraphContainerValue(t,u);c.emitQuadChecked(r,O,n,e,m,l,o)}else if(l&&c.validateReverseSubject(e),s){if(f.rdfstar){f.idStack[r]&&f.emitError(new d.ErrorCoded(`Found an illegal @id inside an annotation: ${f.idStack[r][0].value}`,d.ERROR_CODES.INVALID_ANNOTATION));for(let m=0;m<r;m++)await c.unaliasKeyword(t[m],t,m)==="@id"&&f.emitError(new d.ErrorCoded("Found an illegal annotation inside an embedded node",d.ERROR_CODES.INVALID_ANNOTATION));const O=f.getAnnotationsBufferSafe(u),x={predicate:n,object:e,reverse:l,nestedAnnotations:[],depth:u};O.push(x);for(let m=O.length-2;m>=0;m--){const A=O[m];A.depth>u&&(x.nestedAnnotations.push(A),O.splice(m,1))}}}else f.getUnidentifiedValueBufferSafe(u).push({predicate:n,object:e,reverse:l,isEmbedded:o})}isPropertyHandler(){return!0}isStackProcessor(){return!0}async validate(f,c,t,r,n){const e=t[r];if(e){const l=await f.getContext(t);if(!f.jsonLiteralStack[r]&&await c.predicateToTerm(l,t[r]))return E.Util.getContextValueType(l,e)==="@json"&&(f.jsonLiteralStack[r+1]=!0),!0}return!1}async test(f,c,t,r,n){return r[n]}async handle(f,c,t,r,n,e,l){const o=r[e],s=await f.getContext(r),u=await c.predicateToTerm(s,t);if(u){const h=await c.valueToTerm(s,t,n,e,r);if(h.length)for(let p of h){let b=await c.unaliasKeywordParent(r,e);const O=E.Util.isPropertyReverse(s,o,b);let x=0;for(;b==="@reverse"||typeof b=="number";)typeof b=="number"?x++:e--,b=await c.unaliasKeywordParent(r,e-x);const m=E.Util.isPropertyInEmbeddedNode(b);c.validateReverseInEmbeddedNode(t,O,m);const A=E.Util.isPropertyInAnnotationObject(b);if(n){const w="@list"in E.Util.getContextValueContainer(s,t);if(w||n["@list"]){if((w&&!Array.isArray(n)&&!n["@list"]||n["@list"]&&!Array.isArray(n["@list"]))&&p!==c.rdfNil){const C=c.dataFactory.blankNode();f.emitQuad(e,c.dataFactory.quad(C,c.rdfRest,c.rdfNil,c.getDefaultGraph())),f.emitQuad(e,c.dataFactory.quad(C,c.rdfFirst,p,c.getDefaultGraph())),p=C}if(O&&!f.allowSubjectList)throw new d.ErrorCoded(`Found illegal list value in subject position at ${t}`,d.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}}await St.handlePredicateObject(f,c,r,e,u,p,O,m,A)}}}};return se.EntryHandlerPredicate=a,se}var et;function zt(){if(et)return ae;et=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.ContainerHandlerIndex=void 0;const d=F(),E=Se(),a=W();let g=class{canCombineWithGraph(){return!0}async handle(c,t,r,n,e,l){if(!Array.isArray(e)){const o="@graph"in c,s=await t.getContext(n),u=n[l-1],h=a.Util.getContextValueIndex(s,u);if(h){if(d.Util.isPotentialKeyword(h))throw new d.ErrorCoded(`Keywords can not be used as @index value, got: ${h}`,d.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof h!="string")throw new d.ErrorCoded(`@index values must be strings, got: ${h}`,d.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof e!="object"){if(a.Util.getContextValueType(s,u)!=="@id")throw new d.ErrorCoded(`Property-based index containers require nodes as values or strings with @type: @id, but got: ${e}`,d.ERROR_CODES.INVALID_VALUE_OBJECT);const O=r.resourceToTerm(s,e);O&&(t.idStack[l+1]=[O])}const b=r.createVocabOrBaseTerm(s,h);if(b){const O=await r.valueToTerm(s,h,await r.getContainerKey(n[l],n,l),l,n);if(o){const x=await r.getGraphContainerValue(n,l+1);for(const m of O)t.emitQuad(l,r.dataFactory.quad(x,b,m,r.getDefaultGraph()))}else for(const x of O)await E.EntryHandlerPredicate.handlePredicateObject(t,r,n,l+1,b,x,!1,!1,!1)}}const p=o?2:1;await t.newOnValueJob(n.slice(0,n.length-p),e,l-p,!0),await t.handlePendingContainerFlushBuffers()}t.emittedStack[l]=!1}};return ae.ContainerHandlerIndex=g,ae}var oe={},tt;function Qt(){if(tt)return oe;tt=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.ContainerHandlerLanguage=void 0;const d=F();let E=class{canCombineWithGraph(){return!1}async handle(g,f,c,t,r,n){const e=await c.getContainerKey(t[n],t,n);if(Array.isArray(r))r=r.map(l=>({"@value":l,"@language":e}));else{if(typeof r!="string")throw new d.ErrorCoded(`Got invalid language map value, got '${JSON.stringify(r)}', but expected string`,d.ERROR_CODES.INVALID_LANGUAGE_MAP_VALUE);r={"@value":r,"@language":e}}await f.newOnValueJob(t.slice(0,t.length-1),r,n-1,!0),f.emittedStack[n]=!1}};return oe.ContainerHandlerLanguage=E,oe}var le={},rt;function Zt(){if(rt)return le;rt=1,Object.defineProperty(le,"__esModule",{value:!0}),le.ContainerHandlerType=void 0;const d=Se(),E=W();let a=class{canCombineWithGraph(){return!1}async handle(f,c,t,r,n,e){if(!Array.isArray(n)){if(typeof n=="string"){const s=await c.getContext(r),h=E.Util.getContextValueType(s,r[e-1])==="@vocab"?await t.createVocabOrBaseTerm(s,n):await t.resourceToTerm(s,n);if(h){const p={"@id":h.termType==="NamedNode"?h.value:n};await c.newOnValueJob(r.slice(0,r.length-1),p,e-1,!0),c.idStack[e+1]=[h]}}else{const s=!!c.idStack[e+1];s||delete c.idStack[e],await c.newOnValueJob(r.slice(0,r.length-1),n,e-1,!0),s||(c.idStack[e+1]=c.idStack[e])}const l=await t.getContainerKey(r[e],r,e),o=l!==null?t.createVocabOrBaseTerm(await c.getContext(r),l):null;o&&await d.EntryHandlerPredicate.handlePredicateObject(c,t,r,e+1,t.rdfType,o,!1,!1,!1),await c.handlePendingContainerFlushBuffers()}c.emittedStack[e]=!1}};return le.ContainerHandlerType=a,le}var nt;function Tt(){if(nt)return ne;nt=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.EntryHandlerContainer=void 0;const d=Yt(),E=zt(),a=Qt(),g=Zt(),f=W();let c=class ${static isSimpleGraphContainer(r){return"@graph"in r&&("@set"in r&&Object.keys(r).length===2||Object.keys(r).length===1)}static isComplexGraphContainer(r){return"@graph"in r&&("@set"in r&&Object.keys(r).length>2||!("@set"in r)&&Object.keys(r).length>1)}static getContainerGraphIndex(r,n,e){let l=$.isSimpleGraphContainer(r),o="";for(let s=n;s<e.length;s++)(!l||typeof e[s]=="number")&&(o+=":"+e[s]),!l&&typeof e[s]!="number"&&(l=!0);return o}static async getContainerHandler(r,n,e){const l={containers:{"@set":!0},depth:e,fallback:!0};let o=!1;const s=await r.getContext(n,2);for(let u=e-1;u>=0;u--)if(typeof n[u]!="number"){const h=f.Util.getContextValue(s,"@container",n[u],!1);if(h&&$.isSimpleGraphContainer(h))return{containers:h,depth:u+1,fallback:!1};const p=f.Util.getContextValue(s,"@container",n[u-1],!1);if(p){const b="@graph"in p;for(const O in $.CONTAINER_HANDLERS)if(p[O])return b?$.CONTAINER_HANDLERS[O].canCombineWithGraph()?{containers:p,depth:u,fallback:!1}:l:o?l:{containers:p,depth:u,fallback:!1};return l}else{if(o)return l;o=!0}}return l}static async isBufferableContainerHandler(r,n,e){const l=await $.getContainerHandler(r,n,e);return!l.fallback&&!("@graph"in l.containers)}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(r,n,e,l,o){return!!await this.test(r,n,null,e,l)}async test(r,n,e,l,o){const s=f.Util.getContextValueContainer(await r.getContext(l,2),l[o-1]);for(const u in $.CONTAINER_HANDLERS)if(s[u])return{containers:s,handler:$.CONTAINER_HANDLERS[u]};return null}async handle(r,n,e,l,o,s,u){return u.handler.handle(u.containers,r,n,l,o,s)}};return ne.EntryHandlerContainer=c,c.CONTAINER_HANDLERS={"@id":new d.ContainerHandlerIdentifier,"@index":new E.ContainerHandlerIndex,"@language":new a.ContainerHandlerLanguage,"@type":new g.ContainerHandlerType},ne}var it;function W(){if(it)return re;it=1,Object.defineProperty(re,"__esModule",{value:!0}),re.Util=void 0;const d=F(),E=Mt(),a=Tt(),g=_t();let f=class V{constructor(t){this.parsingContext=t.parsingContext,this.dataFactory=t.dataFactory||new E.DataFactory,this.rdfFirst=this.dataFactory.namedNode(V.RDF+"first"),this.rdfRest=this.dataFactory.namedNode(V.RDF+"rest"),this.rdfNil=this.dataFactory.namedNode(V.RDF+"nil"),this.rdfType=this.dataFactory.namedNode(V.RDF+"type"),this.rdfJson=this.dataFactory.namedNode(V.RDF+"JSON")}static getContextValue(t,r,n,e){const l=t.getContextRaw()[n];if(!l)return e;const o=l[r];return o===void 0?e:o}static getContextValueContainer(t,r){return V.getContextValue(t,"@container",r,{"@set":!0})}static getContextValueType(t,r){const n=V.getContextValue(t,"@type",r,null);return n==="@none"?null:n}static getContextValueLanguage(t,r){return V.getContextValue(t,"@language",r,t.getContextRaw()["@language"]||null)}static getContextValueDirection(t,r){return V.getContextValue(t,"@direction",r,t.getContextRaw()["@direction"]||null)}static isContextValueReverse(t,r){return!!V.getContextValue(t,"@reverse",r,null)}static getContextValueIndex(t,r){return V.getContextValue(t,"@index",r,t.getContextRaw()["@index"]||null)}static isPropertyReverse(t,r,n){return n==="@reverse"!==V.isContextValueReverse(t,r)}static isPropertyInEmbeddedNode(t){return t==="@id"}static isPropertyInAnnotationObject(t){return t==="@annotation"}static isValidIri(t){return t!==null&&d.Util.isValidIri(t)}static isPrefixArray(t,r){if(t.length>r.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==r[n])return!1;return!0}async validateValueIndexes(t){if(this.parsingContext.validateValueIndexes){const r={};for(const n of t)if(n&&typeof n=="object"){const e=n["@id"],l=n["@index"];if(e&&l){const o=r[e];if(o&&o!==l)throw new d.ErrorCoded(`Conflicting @index value for ${e}`,d.ERROR_CODES.CONFLICTING_INDEXES);r[e]=l}}}}async valueToTerm(t,r,n,e,l){if(V.getContextValueType(t,r)==="@json")return[this.dataFactory.literal(this.valueToJsonString(n),this.rdfJson)];const o=typeof n;switch(o){case"object":if(n==null)return[];if(Array.isArray(n))return"@list"in V.getContextValueContainer(t,r)?n.length===0?[this.rdfNil]:this.parsingContext.idStack[e+1]||[]:(await this.validateValueIndexes(n),[]);if(t=await this.getContextSelfOrPropertyScoped(t,r),"@context"in n&&(t=await this.parsingContext.parseContext(n["@context"],(await this.parsingContext.getContext(l,0)).getContextRaw())),n=await this.unaliasKeywords(n,l,e,t),"@value"in n){let s,u,h,p,b;for(r in n){const O=n[r];switch(r){case"@value":s=O;break;case"@language":u=O;break;case"@direction":h=O;break;case"@type":p=O;break;case"@index":b=O;break;case"@annotation":break;default:throw new d.ErrorCoded(`Unknown value entry '${r}' in @value: ${JSON.stringify(n)}`,d.ERROR_CODES.INVALID_VALUE_OBJECT)}}if(await this.unaliasKeyword(p,l,e,!0,t)==="@json")return[this.dataFactory.literal(this.valueToJsonString(s),this.rdfJson)];if(s===null)return[];if(typeof s=="object")throw new d.ErrorCoded(`The value of an '@value' can not be an object, got '${JSON.stringify(s)}'`,d.ERROR_CODES.INVALID_VALUE_OBJECT_VALUE);if(this.parsingContext.validateValueIndexes&&b&&typeof b!="string")throw new d.ErrorCoded(`The value of an '@index' must be a string, got '${JSON.stringify(b)}'`,d.ERROR_CODES.INVALID_INDEX_VALUE);if(u){if(typeof s!="string")throw new d.ErrorCoded(`When an '@language' is set, the value of '@value' must be a string, got '${JSON.stringify(s)}'`,d.ERROR_CODES.INVALID_LANGUAGE_TAGGED_VALUE);if(!d.ContextParser.validateLanguage(u,this.parsingContext.strictValues,d.ERROR_CODES.INVALID_LANGUAGE_TAGGED_STRING))return[];(this.parsingContext.normalizeLanguageTags||this.parsingContext.activeProcessingMode===1)&&(u=u.toLowerCase())}if(h){if(typeof s!="string")throw new Error(`When an '@direction' is set, the value of '@value' must be a string, got '${JSON.stringify(s)}'`);if(!d.ContextParser.validateDirection(h,this.parsingContext.strictValues))return[]}if(u&&h&&this.parsingContext.rdfDirection){if(p)throw new d.ErrorCoded(`Can not have '@language', '@direction' and '@type' in a value: '${JSON.stringify(n)}'`,d.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(e,s,u,h))}else if(u){if(p)throw new d.ErrorCoded(`Can not have both '@language' and '@type' in a value: '${JSON.stringify(n)}'`,d.ERROR_CODES.INVALID_VALUE_OBJECT);return[this.dataFactory.literal(s,u)]}else if(h&&this.parsingContext.rdfDirection){if(p)throw new d.ErrorCoded(`Can not have both '@direction' and '@type' in a value: '${JSON.stringify(n)}'`,d.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(e,s,u,h))}else if(p){if(typeof p!="string")throw new d.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(p)}'`,d.ERROR_CODES.INVALID_TYPED_VALUE);const O=this.createVocabOrBaseTerm(t,p);if(!O)throw new d.ErrorCoded(`Invalid '@type' value, got '${JSON.stringify(p)}'`,d.ERROR_CODES.INVALID_TYPED_VALUE);if(O.termType!=="NamedNode")throw new d.ErrorCoded(`Illegal value type (${O.termType}): ${p}`,d.ERROR_CODES.INVALID_TYPED_VALUE);return[this.dataFactory.literal(s,O)]}return await this.valueToTerm(new d.JsonLdContextNormalized({}),r,s,e,l)}else if("@set"in n){if(Object.keys(n).length>1)throw new d.ErrorCoded(`Found illegal neighbouring entries next to @set for key: '${r}'`,d.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);return[]}else if("@list"in n){if(Object.keys(n).length>1)throw new d.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${r}'`,d.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);const s=n["@list"];return Array.isArray(s)?s.length===0?[this.rdfNil]:this.parsingContext.idStack[e+1]||[]:await this.valueToTerm(await this.parsingContext.getContext(l),r,s,e-1,l.slice(0,-1))}else{if("@reverse"in n&&typeof n["@reverse"]=="boolean")return[];if("@graph"in V.getContextValueContainer(await this.parsingContext.getContext(l),r)){const s=this.parsingContext.graphContainerTermStack[e+1];return s?Object.values(s):[this.dataFactory.blankNode()]}else if("@id"in n){if(Object.keys(n).length>1&&(t=await this.parsingContext.getContext(l,0)),"@context"in n&&(t=await this.parsingContext.parseContext(n["@context"],t.getContextRaw())),n["@type"]==="@vocab")return this.nullableTermToArray(this.createVocabOrBaseTerm(t,n["@id"]));{const s=n["@id"];let u;if(typeof s=="object")if(this.parsingContext.rdfstar)u=this.parsingContext.idStack[e+1][0];else throw new d.ErrorCoded(`Found illegal @id '${n}'`,d.ERROR_CODES.INVALID_ID_VALUE);else u=this.resourceToTerm(t,s);return this.nullableTermToArray(u)}}else return this.parsingContext.emittedStack[e+1]||n&&typeof n=="object"&&Object.keys(n).length===0?this.parsingContext.idStack[e+1]||(this.parsingContext.idStack[e+1]=[this.dataFactory.blankNode()]):[]}case"string":return this.nullableTermToArray(this.stringValueToTerm(e,await this.getContextSelfOrPropertyScoped(t,r),r,n,null));case"boolean":return this.nullableTermToArray(this.stringValueToTerm(e,await this.getContextSelfOrPropertyScoped(t,r),r,(!!n).toString(),this.dataFactory.namedNode(V.XSD_BOOLEAN)));case"number":return this.nullableTermToArray(this.stringValueToTerm(e,await this.getContextSelfOrPropertyScoped(t,r),r,n,this.dataFactory.namedNode(n%1===0&&n<1e21?V.XSD_INTEGER:V.XSD_DOUBLE)));default:return this.parsingContext.emitError(new Error(`Could not determine the RDF type of a ${o}`)),[]}}async getContextSelfOrPropertyScoped(t,r){const n=t.getContextRaw()[r];return n&&typeof n=="object"&&"@context"in n&&(t=await this.parsingContext.parseContext(n,t.getContextRaw(),!0)),t}nullableTermToArray(t){return t?[t]:[]}predicateToTerm(t,r){const n=t.expandTerm(r,!0,this.parsingContext.getExpandOptions());if(!n)return null;if(n[0]==="_"&&n[1]===":")return this.parsingContext.produceGeneralizedRdf?this.dataFactory.blankNode(n.substr(2)):null;if(V.isValidIri(n))return this.dataFactory.namedNode(n);if(n&&this.parsingContext.strictValues)this.parsingContext.emitError(new d.ErrorCoded(`Invalid predicate IRI: ${n}`,d.ERROR_CODES.INVALID_IRI_MAPPING));else return null;return null}resourceToTerm(t,r){if(r.startsWith("_:"))return this.dataFactory.blankNode(r.substr(2));const n=t.expandTerm(r,!1,this.parsingContext.getExpandOptions());if(!V.isValidIri(n))if(n&&this.parsingContext.strictValues)this.parsingContext.emitError(new Error(`Invalid resource IRI: ${n}`));else return null;return this.dataFactory.namedNode(n)}createVocabOrBaseTerm(t,r){if(r.startsWith("_:"))return this.dataFactory.blankNode(r.substr(2));const n=this.parsingContext.getExpandOptions();let e=t.expandTerm(r,!0,n);if(e===r&&(e=t.expandTerm(r,!1,n)),!V.isValidIri(e))if(e&&this.parsingContext.strictValues&&!e.startsWith("@"))this.parsingContext.emitError(new Error(`Invalid term IRI: ${e}`));else return null;return this.dataFactory.namedNode(e)}intToString(t,r){return typeof t=="number"?Number.isFinite(t)?t%1===0&&(!r||r.value!==V.XSD_DOUBLE)?Number(t).toString():t.toExponential(15).replace(/(\d)0*e\+?/,"$1E"):t>0?"INF":"-INF":t}stringValueToTerm(t,r,n,e,l){const o=V.getContextValueType(r,n);if(o)if(o==="@id"){if(!l)return this.resourceToTerm(r,this.intToString(e,l))}else if(o==="@vocab"){if(!l)return this.createVocabOrBaseTerm(r,this.intToString(e,l))}else l=this.dataFactory.namedNode(o);if(!l){const s=V.getContextValueLanguage(r,n),u=V.getContextValueDirection(r,n);return u&&this.parsingContext.rdfDirection?this.createLanguageDirectionLiteral(t,this.intToString(e,l),s,u):this.dataFactory.literal(this.intToString(e,l),s)}return this.dataFactory.literal(this.intToString(e,l),l)}createLanguageDirectionLiteral(t,r,n,e){if(this.parsingContext.rdfDirection==="i18n-datatype")return n||(n=""),this.dataFactory.literal(r,this.dataFactory.namedNode(`https://www.w3.org/ns/i18n#${n}_${e}`));{const l=this.dataFactory.blankNode(),o=this.getDefaultGraph();return this.parsingContext.emitQuad(t,this.dataFactory.quad(l,this.dataFactory.namedNode(V.RDF+"value"),this.dataFactory.literal(r),o)),n&&this.parsingContext.emitQuad(t,this.dataFactory.quad(l,this.dataFactory.namedNode(V.RDF+"language"),this.dataFactory.literal(n),o)),this.parsingContext.emitQuad(t,this.dataFactory.quad(l,this.dataFactory.namedNode(V.RDF+"direction"),this.dataFactory.literal(e),o)),l}}valueToJsonString(t){return g(t)}async unaliasKeyword(t,r,n,e,l){if(Number.isInteger(t))return t;if(!e){const o=this.parsingContext.unaliasedKeywordCacheStack[n];if(o)return o}if(!d.Util.isPotentialKeyword(t)){l=l||await this.parsingContext.getContext(r);let o=l.getContextRaw()[t];o&&typeof o=="object"&&(o=o["@id"]),d.Util.isValidKeyword(o)&&(t=o)}return e?t:this.parsingContext.unaliasedKeywordCacheStack[n]=t}async unaliasKeywordParent(t,r){return await this.unaliasKeyword(r>0&&t[r-1],t,r-1)}async unaliasKeywords(t,r,n,e){const l={};for(const o in t)l[await this.unaliasKeyword(o,r,n+1,!0,e)]=t[o];return l}async isLiteral(t,r){for(let n=r;n>=0;n--){if(await this.unaliasKeyword(t[n],t,n)==="@annotation")return!1;if(this.parsingContext.literalStack[n]||this.parsingContext.jsonLiteralStack[n])return!0}return!1}async getDepthOffsetGraph(t,r){for(let n=t-1;n>0;n--)if(await this.unaliasKeyword(r[n],r,n)==="@graph"){const e=(await a.EntryHandlerContainer.getContainerHandler(this.parsingContext,r,n)).containers;return a.EntryHandlerContainer.isComplexGraphContainer(e)?-1:t-n-1}return-1}validateReverseSubject(t){if(t.termType==="Literal")throw new d.ErrorCoded(`Found illegal literal in subject position: ${t.value}`,d.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}getDefaultGraph(){return this.parsingContext.defaultGraph||this.dataFactory.defaultGraph()}async getGraphContainerValue(t,r){let n=this.getDefaultGraph();const{containers:e,depth:l}=await a.EntryHandlerContainer.getContainerHandler(this.parsingContext,t,r);if("@graph"in e){const o=a.EntryHandlerContainer.getContainerGraphIndex(e,l,t),s=this.parsingContext.graphContainerTermStack[l];if(n=s?s[o]:null,!n){let u=null;if("@id"in e){const h=await this.getContainerKey(t[l],t,l);h!==null&&(u=await this.resourceToTerm(await this.parsingContext.getContext(t),h))}u||(u=this.dataFactory.blankNode()),this.parsingContext.graphContainerTermStack[l]||(this.parsingContext.graphContainerTermStack[l]={}),n=this.parsingContext.graphContainerTermStack[l][o]=u}}return n}async getPropertiesDepth(t,r){let n=r;for(let e=r-1;e>0;e--)if(typeof t[e]!="number"){const l=await this.unaliasKeyword(t[e],t,e);if(l==="@reverse")return e;if(l==="@nest")n=e;else return n}return n}async getContainerKey(t,r,n){const e=await this.unaliasKeyword(t,r,n);return e==="@none"?null:e}validateReverseInEmbeddedNode(t,r,n){if(n&&r&&!this.parsingContext.rdfstarReverseInEmbedded)throw new d.ErrorCoded(`Illegal reverse property in embedded node in ${t}`,d.ERROR_CODES.INVALID_EMBEDDED_NODE)}emitQuadChecked(t,r,n,e,l,o,s){let u;if(o?(this.validateReverseSubject(e),u=this.dataFactory.quad(e,n,r,l)):u=this.dataFactory.quad(r,n,e,l),s){if(u.graph.termType!=="DefaultGraph"&&(u=this.dataFactory.quad(u.subject,u.predicate,u.object)),this.parsingContext.idStack[t-1])throw new d.ErrorCoded("Illegal multiple properties in an embedded node",d.ERROR_CODES.INVALID_EMBEDDED_NODE);this.parsingContext.idStack[t-1]=[u]}else this.parsingContext.emitQuad(t,u);const h=this.parsingContext.annotationsBuffer[t];if(h){for(const p of h)this.emitAnnotation(t,u,p);delete this.parsingContext.annotationsBuffer[t]}}emitAnnotation(t,r,n){let e;n.reverse?(this.validateReverseSubject(n.object),e=this.dataFactory.quad(n.object,n.predicate,r)):e=this.dataFactory.quad(r,n.predicate,n.object),this.parsingContext.emitQuad(t,e);for(const l of n.nestedAnnotations)this.emitAnnotation(t,e,l)}};return re.Util=f,f.XSD="http://www.w3.org/2001/XMLSchema#",f.XSD_BOOLEAN=f.XSD+"boolean",f.XSD_INTEGER=f.XSD+"integer",f.XSD_DOUBLE=f.XSD+"double",f.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#",re}var at;function er(){if(at)return te;at=1,Object.defineProperty(te,"__esModule",{value:!0}),te.EntryHandlerArrayValue=void 0;const d=W(),E=F();let a=class{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(f,c,t,r,n){return this.test(f,c,null,t,r)}async test(f,c,t,r,n){return typeof r[n]=="number"}async handle(f,c,t,r,n,e){let l=await c.unaliasKeywordParent(r,e);if(l==="@list"){let o=null,s=0;for(let u=e-2;u>0;u--){const h=r[u];if(typeof h=="string"||typeof h=="number"){s=u,o=h;break}}if(o!==null){const u=await c.valueToTerm(await f.getContext(r),o,n,e,r);for(const h of u)await this.handleListElement(f,c,h,n,e,r.slice(0,s),s);u.length===0&&await this.handleListElement(f,c,null,n,e,r.slice(0,s),s)}}else if(l==="@set")await f.newOnValueJob(r.slice(0,-2),n,e-2,!1);else if(l!==void 0&&l!=="@type"){for(let s=e-1;s>0;s--)if(typeof r[s]!="number"){l=await c.unaliasKeyword(r[s],r,s);break}const o=await f.getContext(r.slice(0,-1));if("@list"in d.Util.getContextValueContainer(o,l)){f.emittedStack[e+1]=!0;const s=await c.valueToTerm(await f.getContext(r),l,n,e,r);for(const u of s)await this.handleListElement(f,c,u,n,e,r.slice(0,-1),e-1);s.length===0&&await this.handleListElement(f,c,null,n,e,r.slice(0,-1),e-1)}else f.shiftStack(e,1),await f.newOnValueJob(r.slice(0,-1),n,e-1,!1),f.contextTree.removeContext(r.slice(0,-1))}}async handleListElement(f,c,t,r,n,e,l){let o=f.listPointerStack[n];if(r!==null&&(await c.unaliasKeywords(r,e,n))["@value"]!==null){if(!o||!o.value){const s=c.dataFactory.blankNode();o={value:s,listRootDepth:l,listId:s}}else{const s=c.dataFactory.blankNode();f.emitQuad(n,c.dataFactory.quad(o.value,c.rdfRest,s,c.getDefaultGraph())),o.value=s}t&&f.emitQuad(n,c.dataFactory.quad(o.value,c.rdfFirst,t,c.getDefaultGraph()))}else o||(o={listRootDepth:l,listId:c.rdfNil});f.listPointerStack[n]=o,f.rdfstar&&f.annotationsBuffer[n]&&f.emitError(new E.ErrorCoded("Found an illegal annotation inside a list",E.ERROR_CODES.INVALID_ANNOTATION))}};return te.EntryHandlerArrayValue=a,te}var de={},st;function tr(){if(st)return de;st=1,Object.defineProperty(de,"__esModule",{value:!0}),de.EntryHandlerInvalidFallback=void 0;let d=class{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(a,g,f,c,t){return!1}async test(a,g,f,c,t){return!0}async handle(a,g,f,c,t,r){a.emittedStack[r]=!1}};return de.EntryHandlerInvalidFallback=d,de}var ce={},fe={},ot;function J(){if(ot)return fe;ot=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.EntryHandlerKeyword=void 0;let d=class{constructor(a){this.keyword=a}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(a,g,f,c,t){return!1}async test(a,g,f,c,t){return f===this.keyword}};return fe.EntryHandlerKeyword=d,fe}var lt;function rr(){if(lt)return ce;lt=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.EntryHandlerKeywordContext=void 0;const d=F(),E=J();let a=class extends E.EntryHandlerKeyword{constructor(){super("@context")}isStackProcessor(){return!1}async handle(f,c,t,r,n,e){f.streamingProfile&&(f.processingStack[e]||f.processingType[e]||f.idStack[e]!==void 0)&&f.emitError(new d.ErrorCoded("Found an out-of-order context, while streaming is enabled.(disable `streamingProfile`)",d.ERROR_CODES.INVALID_STREAMING_KEY_ORDER));const l=f.getContext(r),o=f.parseContext(n,(await l).getContextRaw());f.contextTree.setContext(r.slice(0,-1),o),f.emitContext(n),await f.validateContext(await o)}};return ce.EntryHandlerKeywordContext=a,ce}var ue={},dt;function nr(){if(dt)return ue;dt=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.EntryHandlerKeywordGraph=void 0;const d=J();let E=class extends d.EntryHandlerKeyword{constructor(){super("@graph")}async handle(g,f,c,t,r,n){g.graphStack[n+1]=!0}};return ue.EntryHandlerKeywordGraph=E,ue}var he={},ct;function ir(){if(ct)return he;ct=1,Object.defineProperty(he,"__esModule",{value:!0}),he.EntryHandlerKeywordId=void 0;const d=F(),E=J();let a=class extends E.EntryHandlerKeyword{constructor(){super("@id")}isStackProcessor(){return!1}async handle(f,c,t,r,n,e){if(typeof n!="string"){if(f.rdfstar&&typeof n=="object"){const o=Object.keys(n);o.length===1&&o[0]==="@id"&&f.emitError(new d.ErrorCoded(`Invalid embedded node without property with @id ${n["@id"]}`,d.ERROR_CODES.INVALID_EMBEDDED_NODE))}else f.emitError(new d.ErrorCoded(`Found illegal @id '${n}'`,d.ERROR_CODES.INVALID_ID_VALUE));return}const l=await c.getPropertiesDepth(r,e);if(f.idStack[l]!==void 0&&(f.idStack[l][0].listHead?f.emitError(new d.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${r[e-1]}'`,d.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT)):f.emitError(new d.ErrorCoded(`Found duplicate @ids '${f.idStack[l][0].value}' and '${n}'`,d.ERROR_CODES.COLLIDING_KEYWORDS))),f.rdfstar&&f.annotationsBuffer[e])for(const o of f.annotationsBuffer[e])o.depth===e&&f.emitError(new d.ErrorCoded(`Found an illegal @id inside an annotation: ${n}`,d.ERROR_CODES.INVALID_ANNOTATION));f.idStack[l]=c.nullableTermToArray(await c.resourceToTerm(await f.getContext(r),n))}};return he.EntryHandlerKeywordId=a,he}var ye={},ft;function ar(){if(ft)return ye;ft=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.EntryHandlerKeywordIncluded=void 0;const d=F(),E=J();let a=class extends E.EntryHandlerKeyword{constructor(){super("@included")}async handle(f,c,t,r,n,e){typeof n!="object"&&f.emitError(new d.ErrorCoded(`Found illegal @included '${n}'`,d.ERROR_CODES.INVALID_INCLUDED_VALUE));const l=await c.unaliasKeywords(n,r,e,await f.getContext(r));"@value"in l&&f.emitError(new d.ErrorCoded(`Found an illegal @included @value node '${JSON.stringify(n)}'`,d.ERROR_CODES.INVALID_INCLUDED_VALUE)),"@list"in l&&f.emitError(new d.ErrorCoded(`Found an illegal @included @list node '${JSON.stringify(n)}'`,d.ERROR_CODES.INVALID_INCLUDED_VALUE)),f.emittedStack[e]=!1}};return ye.EntryHandlerKeywordIncluded=a,ye}var Ee={},ut;function sr(){if(ut)return Ee;ut=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.EntryHandlerKeywordNest=void 0;const d=F(),E=J();let a=class extends E.EntryHandlerKeyword{constructor(){super("@nest")}async handle(f,c,t,r,n,e){typeof n!="object"&&f.emitError(new d.ErrorCoded(`Found invalid @nest entry for '${t}': '${n}'`,d.ERROR_CODES.INVALID_NEST_VALUE)),"@value"in await c.unaliasKeywords(n,r,e,await f.getContext(r))&&f.emitError(new d.ErrorCoded(`Found an invalid @value node for '${t}'`,d.ERROR_CODES.INVALID_NEST_VALUE)),f.emittedStack[e]=!1}};return Ee.EntryHandlerKeywordNest=a,Ee}var ge={},ht;function or(){if(ht)return ge;ht=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.EntryHandlerKeywordType=void 0;const d=F(),E=W(),a=Se(),g=J();let f=class extends g.EntryHandlerKeyword{constructor(){super("@type")}isStackProcessor(){return!1}async handle(t,r,n,e,l,o){const s=e[o],u=await t.getContext(e),h=r.rdfType,p=await r.unaliasKeywordParent(e,o),b=E.Util.isPropertyReverse(u,s,p),O=E.Util.isPropertyInEmbeddedNode(p);r.validateReverseInEmbeddedNode(n,b,O);const x=E.Util.isPropertyInAnnotationObject(p),m=Array.isArray(l)?l:[l];for(const C of m){typeof C!="string"&&t.emitError(new d.ErrorCoded(`Found illegal @type '${C}'`,d.ERROR_CODES.INVALID_TYPE_VALUE));const S=r.createVocabOrBaseTerm(u,C);S&&await a.EntryHandlerPredicate.handlePredicateObject(t,r,e,o,h,S,b,O,x)}let A=Promise.resolve(u),w=!1;for(const C of m.sort()){const S=E.Util.getContextValue(u,"@context",C,null);S&&(w=!0,A=A.then(L=>t.parseContext(S,L.getContextRaw())))}t.streamingProfile&&(w||!t.streamingProfileAllowOutOfOrderPlainType)&&(t.processingStack[o]||t.idStack[o])&&t.emitError(new d.ErrorCoded("Found an out-of-order type-scoped context, while streaming is enabled.(disable `streamingProfile`)",d.ERROR_CODES.INVALID_STREAMING_KEY_ORDER)),w&&(A=A.then(C=>("@propagate"in C.getContextRaw()||(C.getContextRaw()["@propagate"]=!1),C.getContextRaw()["@propagate"]===!1&&(C.getContextRaw()["@__propagateFallback"]=u.getContextRaw()),C)),t.contextTree.setContext(e.slice(0,e.length-1),A)),t.processingType[o]=!0}};return ge.EntryHandlerKeywordType=f,ge}var pe={},yt;function lr(){if(yt)return pe;yt=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.EntryHandlerKeywordUnknownFallback=void 0;const d=F();let E=class At{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(g,f,c,t,r){const n=await f.unaliasKeyword(c[t],c,t);return d.Util.isPotentialKeyword(n)?!(!r&&n==="@list"):!1}async test(g,f,c,t,r){return d.Util.isPotentialKeyword(c)}async handle(g,f,c,t,r,n){const e=At.VALID_KEYWORDS_TYPES[c];e!==void 0?e&&typeof r!==e.type&&g.emitError(new d.ErrorCoded(`Invalid value type for '${c}' with value '${r}'`,e.errorCode)):g.strictValues&&g.emitError(new Error(`Unknown keyword '${c}' with value '${r}'`)),g.emittedStack[n]=!1}};return pe.EntryHandlerKeywordUnknownFallback=E,E.VALID_KEYWORDS_TYPES={"@index":{type:"string",errorCode:d.ERROR_CODES.INVALID_INDEX_VALUE},"@list":null,"@reverse":{type:"object",errorCode:d.ERROR_CODES.INVALID_REVERSE_VALUE},"@set":null,"@value":null},pe}var we={},Et;function dr(){if(Et)return we;Et=1,Object.defineProperty(we,"__esModule",{value:!0}),we.EntryHandlerKeywordValue=void 0;const d=J();let E=class extends d.EntryHandlerKeyword{constructor(){super("@value")}async validate(g,f,c,t,r){const n=c[t];return n&&!g.literalStack[t]&&await this.test(g,f,n,c,t)&&(g.literalStack[t]=!0),super.validate(g,f,c,t,r)}async test(g,f,c,t,r){return await f.unaliasKeyword(t[r],t.slice(0,t.length-1),r-1,!0)==="@value"}async handle(g,f,c,t,r,n){g.literalStack[n]=!0,delete g.unidentifiedValuesBuffer[n],delete g.unidentifiedGraphsBuffer[n],g.emittedStack[n]=!1}};return we.EntryHandlerKeywordValue=E,we}var Ie={},Ce={},gt;function cr(){if(gt)return Ce;gt=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.ContextTree=void 0;let d=class Nt{constructor(){this.subTrees={}}getContext(a){if(a.length>0){const[g,...f]=a,c=this.subTrees[g];if(c){const t=c.getContext(f);if(t)return t.then(({context:r,depth:n})=>({context:r,depth:n+1}))}}return this.context?this.context.then(g=>({context:g,depth:0})):null}setContext(a,g){if(a.length===0)this.context=g;else{const[f,...c]=a;let t=this.subTrees[f];t||(t=this.subTrees[f]=new Nt),t.setContext(c,g)}}removeContext(a){this.setContext(a,null)}};return Ce.ContextTree=d,Ce}var pt;function fr(){if(pt)return Ie;pt=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.ParsingContext=void 0;const d=F(),E=Re(),a=cr(),g=Lt();let f=class vt{constructor(t){this.contextParser=new d.ContextParser({documentLoader:t.documentLoader,skipValidation:t.skipContextValidation}),this.streamingProfile=!!t.streamingProfile,this.baseIRI=t.baseIRI,this.produceGeneralizedRdf=!!t.produceGeneralizedRdf,this.allowSubjectList=!!t.allowSubjectList,this.processingMode=t.processingMode||g.JsonLdParser.DEFAULT_PROCESSING_MODE,this.strictValues=!!t.strictValues,this.validateValueIndexes=!!t.validateValueIndexes,this.defaultGraph=t.defaultGraph,this.rdfDirection=t.rdfDirection,this.normalizeLanguageTags=t.normalizeLanguageTags,this.streamingProfileAllowOutOfOrderPlainType=t.streamingProfileAllowOutOfOrderPlainType,this.rdfstar=t.rdfstar!==!1,this.rdfstarReverseInEmbedded=t.rdfstarReverseInEmbedded,this.topLevelProperties=!1,this.activeProcessingMode=parseFloat(this.processingMode),this.processingStack=[],this.processingType=[],this.emittedStack=[],this.idStack=[],this.graphStack=[],this.graphContainerTermStack=[],this.listPointerStack=[],this.contextTree=new a.ContextTree,this.literalStack=[],this.validationStack=[],this.unaliasedKeywordCacheStack=[],this.jsonLiteralStack=[],this.unidentifiedValuesBuffer=[],this.unidentifiedGraphsBuffer=[],this.annotationsBuffer=[],this.pendingContainerFlushBuffers=[],this.parser=t.parser,t.context?(this.rootContext=this.parseContext(t.context),this.rootContext.then(r=>this.validateContext(r))):this.rootContext=Promise.resolve(new d.JsonLdContextNormalized(this.baseIRI?{"@base":this.baseIRI,"@__baseDocument":!0}:{}))}async parseContext(t,r,n){return this.contextParser.parse(t,{baseIRI:this.baseIRI,ignoreProtection:n,normalizeLanguageTags:this.normalizeLanguageTags,parentContext:r,processingMode:this.activeProcessingMode})}validateContext(t){const r=t.getContextRaw()["@version"];if(r){if(this.activeProcessingMode&&r>this.activeProcessingMode)throw new E.ErrorCoded(`Unsupported JSON-LD version '${r}' under active processing mode ${this.activeProcessingMode}.`,E.ERROR_CODES.PROCESSING_MODE_CONFLICT);if(this.activeProcessingMode&&r<this.activeProcessingMode)throw new E.ErrorCoded(`Invalid JSON-LD version ${r} under active processing mode ${this.activeProcessingMode}.`,E.ERROR_CODES.INVALID_VERSION_VALUE);this.activeProcessingMode=r}}async getContext(t,r=1){const n=t;for(;typeof t[t.length-1]=="number";)t=t.slice(0,t.length-1);r&&(t=t.slice(0,-r));const e=await this.getContextPropagationAware(t);let o=e.context.getContextRaw();for(let s=e.depth;s<n.length-r;s++){const u=n[s],h=o[u];if(h&&typeof h=="object"&&"@context"in h){const p=(await this.parseContext(h,o,!0)).getContextRaw(),b=!(u in p)||p[u]["@context"]["@propagate"];(b!==!1||s===n.length-1-r)&&(o=p,delete o["@propagate"],o[u]=Object.assign({},o[u]),"@id"in h&&(o[u]["@id"]=h["@id"]),delete o[u]["@context"],b!==!1&&this.contextTree.setContext(n.slice(0,s+r),Promise.resolve(new d.JsonLdContextNormalized(o))))}}return new d.JsonLdContextNormalized(o)}async getContextPropagationAware(t){const r=t.length;let n=null,e;do{e=!1,n&&"@__propagateFallback"in n.context.getContextRaw()?n.context=new d.JsonLdContextNormalized(n.context.getContextRaw()["@__propagateFallback"]):(n&&(t=t.slice(0,n.depth-1)),n=await this.contextTree.getContext(t)||{context:await this.rootContext,depth:0});const l=t[t.length-1];if(l in n.context.getContextRaw()){const o=n.context.getContextRaw()[l];o&&typeof o=="object"&&"@context"in o&&(e=!0)}}while(n.depth>0&&n.context.getContextRaw()["@propagate"]===!1&&n.depth!==r&&!e);return n.depth===0&&n.context.getContextRaw()["@propagate"]===!1&&n.depth!==r&&(n.context=new d.JsonLdContextNormalized({})),n}async newOnValueJob(t,r,n,e){await this.parser.newOnValueJob(t,r,n,e)}async handlePendingContainerFlushBuffers(){if(this.pendingContainerFlushBuffers.length>0){for(const t of this.pendingContainerFlushBuffers)await this.parser.flushBuffer(t.depth,t.keys),this.parser.flushStacks(t.depth);return this.pendingContainerFlushBuffers.splice(0,this.pendingContainerFlushBuffers.length),!0}else return!1}emitQuad(t,r){t===1&&(this.topLevelProperties=!0),this.parser.push(r)}emitError(t){this.parser.emit("error",t)}emitContext(t){this.parser.emit("context",t)}getUnidentifiedValueBufferSafe(t){let r=this.unidentifiedValuesBuffer[t];return r||(r=[],this.unidentifiedValuesBuffer[t]=r),r}getUnidentifiedGraphBufferSafe(t){let r=this.unidentifiedGraphsBuffer[t];return r||(r=[],this.unidentifiedGraphsBuffer[t]=r),r}getAnnotationsBufferSafe(t){let r=this.annotationsBuffer[t];return r||(r=[],this.annotationsBuffer[t]=r),r}getExpandOptions(){return vt.EXPAND_OPTIONS[this.activeProcessingMode]}shiftStack(t,r){const n=this.idStack[t+r];if(n&&(this.idStack[t]=n,this.emittedStack[t]=!0,delete this.idStack[t+r]),this.pendingContainerFlushBuffers.length)for(const e of this.pendingContainerFlushBuffers)e.depth>=t+r&&(e.depth-=r,e.keys.splice(t,r));this.unidentifiedValuesBuffer[t+r]&&(this.unidentifiedValuesBuffer[t]=this.unidentifiedValuesBuffer[t+r],delete this.unidentifiedValuesBuffer[t+r]),this.annotationsBuffer[t+r-1]&&(this.annotationsBuffer[t-1]||(this.annotationsBuffer[t-1]=[]),this.annotationsBuffer[t-1]=[...this.annotationsBuffer[t-1],...this.annotationsBuffer[t+r-1]],delete this.annotationsBuffer[t+r-1])}};return Ie.ParsingContext=f,f.EXPAND_OPTIONS={1:{allowPrefixForcing:!1,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!1},1.1:{allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}},Ie}var _e={},wt;function ur(){if(wt)return _e;wt=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.EntryHandlerKeywordAnnotation=void 0;const d=J(),E=F();let a=class extends d.EntryHandlerKeyword{constructor(){super("@annotation")}async handle(f,c,t,r,n,e){(typeof n=="string"||typeof n=="object"&&n["@value"])&&f.emitError(new E.ErrorCoded(`Found illegal annotation value: ${JSON.stringify(n)}`,E.ERROR_CODES.INVALID_ANNOTATION))}};return _e.EntryHandlerKeywordAnnotation=a,_e}var It;function Lt(){if(It)return z;It=1,Object.defineProperty(z,"__esModule",{value:!0}),z.JsonLdParser=void 0;const d=qt(),E=F(),a=kt(),g=er(),f=Tt(),c=tr(),t=Se(),r=rr(),n=nr(),e=ir(),l=ar(),o=sr(),s=or(),u=lr(),h=dr(),p=fr(),b=W(),O=bt(),x=ur();let m=class Y extends a.Transform{constructor(w){super({readableObjectMode:!0}),w=w||{},this.options=w,this.parsingContext=new p.ParsingContext(Object.assign({parser:this},w)),this.util=new b.Util({dataFactory:w.dataFactory,parsingContext:this.parsingContext}),this.jsonParser=new d,this.contextJobs=[],this.typeJobs=[],this.contextAwaitingJobs=[],this.lastDepth=0,this.lastKeys=[],this.lastOnValueJob=Promise.resolve(),this.attachJsonParserListeners(),this.on("end",()=>{typeof this.jsonParser.mode<"u"&&this.emit("error",new Error("Unclosed document"))})}static fromHttpResponse(w,C,S,L){let y;if(C!=="application/ld+json"){if(C!=="application/json"&&!C.endsWith("+json"))throw new E.ErrorCoded(`Unsupported JSON-LD media type ${C}`,E.ERROR_CODES.LOADING_DOCUMENT_FAILED);if(S&&S.has("Link")&&S.forEach((T,D)=>{if(D==="link"){const P=(0,O.parse)(T);for(const N of P.get("rel","http://www.w3.org/ns/json-ld#context")){if(y)throw new E.ErrorCoded("Multiple JSON-LD context link headers were found on "+w,E.ERROR_CODES.MULTIPLE_CONTEXT_LINK_HEADERS);y=N.uri}}}),!y&&!(L!=null&&L.ignoreMissingContextLinkHeader))throw new E.ErrorCoded(`Missing context link header for media type ${C} on ${w}`,E.ERROR_CODES.LOADING_DOCUMENT_FAILED)}let I;if(S&&S.has("Content-Type")){const T=S.get("Content-Type"),D=/; *profile=([^"]*)/.exec(T);D&&D[1]==="http://www.w3.org/ns/json-ld#streaming"&&(I=!0)}return new Y(Object.assign({baseIRI:w,context:y,streamingProfile:I},L||{}))}import(w){if("pipe"in w){w.on("error",S=>C.emit("error",S));const C=w.pipe(new Y(this.options));return C}else{const C=new a.PassThrough({readableObjectMode:!0});w.on("error",L=>S.emit("error",L)),w.on("data",L=>C.push(L)),w.on("end",()=>C.push(null));const S=C.pipe(new Y(this.options));return S}}_transform(w,C,S){this.jsonParser.write(w),this.lastOnValueJob.then(()=>S(),L=>S(L))}async newOnValueJob(w,C,S,L){let y=!0;if(L&&S<this.lastDepth){const N=this.parsingContext.listPointerStack[this.lastDepth];N&&(N.value&&this.push(this.util.dataFactory.quad(N.value,this.util.rdfRest,this.util.rdfNil,this.util.getDefaultGraph())),N.listId.listHead=!0,this.parsingContext.idStack[N.listRootDepth+1]=[N.listId],this.parsingContext.listPointerStack.splice(this.lastDepth,1)),await f.EntryHandlerContainer.isBufferableContainerHandler(this.parsingContext,this.lastKeys,this.lastDepth)?(this.parsingContext.pendingContainerFlushBuffers.push({depth:this.lastDepth,keys:this.lastKeys.slice(0,this.lastKeys.length)}),y=!1):await this.flushBuffer(this.lastDepth,this.lastKeys)}const I=await this.util.unaliasKeyword(w[S],w,S),T=await this.util.unaliasKeywordParent(w,S);this.parsingContext.emittedStack[S]=!0;let D=!0;E.Util.isValidKeyword(I)&&T==="@reverse"&&I!=="@context"&&this.emit("error",new E.ErrorCoded(`Found the @id '${C}' inside an @reverse property`,E.ERROR_CODES.INVALID_REVERSE_PROPERTY_MAP));let P=!1;this.parsingContext.validationStack.length>1&&(P=this.parsingContext.validationStack[this.parsingContext.validationStack.length-1].property);for(let N=Math.max(1,this.parsingContext.validationStack.length-1);N<w.length-1;N++){const H=this.parsingContext.validationStack[N]||(this.parsingContext.validationStack[N]=await this.validateKey(w.slice(0,N+1),N,P));if(H.valid)!P&&H.property&&(P=!0);else{this.parsingContext.emittedStack[S]=!1,D=!1;break}}if(await this.util.isLiteral(w,S)&&(D=!1),D)for(const N of Y.ENTRY_HANDLERS){const H=await N.test(this.parsingContext,this.util,I,w,S);if(H){await N.handle(this.parsingContext,this.util,I,w,C,S,H),N.isStackProcessor()&&(this.parsingContext.processingStack[S]=!0);break}}S===0&&Array.isArray(C)&&await this.util.validateValueIndexes(C),y&&S<this.lastDepth&&this.flushStacks(this.lastDepth),this.lastDepth=S,this.lastKeys=w,this.parsingContext.unaliasedKeywordCacheStack.splice(S-1)}flushStacks(w){this.parsingContext.processingStack.splice(w,1),this.parsingContext.processingType.splice(w,1),this.parsingContext.emittedStack.splice(w,1),this.parsingContext.idStack.splice(w,1),this.parsingContext.graphStack.splice(w+1,1),this.parsingContext.graphContainerTermStack.splice(w,1),this.parsingContext.jsonLiteralStack.splice(w,1),this.parsingContext.validationStack.splice(w-1,2),this.parsingContext.literalStack.splice(w,this.parsingContext.literalStack.length-w),this.parsingContext.annotationsBuffer.splice(w,1)}async flushBuffer(w,C){let S=this.parsingContext.idStack[w];!!S||(S=this.parsingContext.idStack[w]=[this.util.dataFactory.blankNode()]);const y=this.parsingContext.unidentifiedValuesBuffer[w];if(y){for(const D of S){const P=await this.util.getDepthOffsetGraph(w,C),N=this.parsingContext.graphStack[w]||P>=0?this.parsingContext.idStack[w-P-1]:[await this.util.getGraphContainerValue(C,w)];if(N)for(const H of N){this.parsingContext.emittedStack[w]=!0;for(const U of y)this.util.emitQuadChecked(w,D,U.predicate,U.object,H,U.reverse,U.isEmbedded)}else{const H=this.parsingContext.getUnidentifiedGraphBufferSafe(w-await this.util.getDepthOffsetGraph(w,C)-1);for(const U of y)U.reverse?H.push({object:D,predicate:U.predicate,subject:U.object,isEmbedded:U.isEmbedded}):H.push({object:U.object,predicate:U.predicate,subject:D,isEmbedded:U.isEmbedded})}}this.parsingContext.unidentifiedValuesBuffer.splice(w,1),this.parsingContext.literalStack.splice(w,1),this.parsingContext.jsonLiteralStack.splice(w,1)}const I=this.parsingContext.unidentifiedGraphsBuffer[w];if(I){for(const D of S){const P=w===1&&D.termType==="BlankNode"&&!this.parsingContext.topLevelProperties?this.util.getDefaultGraph():D;this.parsingContext.emittedStack[w]=!0;for(const N of I)this.parsingContext.emitQuad(w,this.util.dataFactory.quad(N.subject,N.predicate,N.object,P))}this.parsingContext.unidentifiedGraphsBuffer.splice(w,1)}const T=this.parsingContext.annotationsBuffer[w];if(T){T.length>0&&w===1&&this.parsingContext.emitError(new E.ErrorCoded("Annotations can not be made on top-level nodes",E.ERROR_CODES.INVALID_ANNOTATION));const D=this.parsingContext.getAnnotationsBufferSafe(w-1);for(const P of T)D.push(P);delete this.parsingContext.annotationsBuffer[w]}}async validateKey(w,C,S){for(const L of Y.ENTRY_HANDLERS)if(await L.validate(this.parsingContext,this.util,w,C,S))return{valid:!0,property:S||L.isPropertyHandler()};return{valid:!1,property:!1}}attachJsonParserListeners(){this.jsonParser.onValue=w=>{const C=this.jsonParser.stack.length,S=new Array(C+1).fill(0).map((L,y)=>y===C?this.jsonParser.key:this.jsonParser.stack[y].key);if(!this.isParsingContextInner(C)){const L=()=>this.newOnValueJob(S,w,C,!0);if(!this.parsingContext.streamingProfile&&!this.parsingContext.contextTree.getContext(S.slice(0,-1)))if(S[C]==="@context"){let y=this.contextJobs[C];y||(y=this.contextJobs[C]=[]),y.push(L)}else S[C]==="@type"||typeof S[C]=="number"&&S[C-1]==="@type"?this.typeJobs.push({job:L,keys:S.slice(0,S.length-1)}):this.contextAwaitingJobs.push({job:L,keys:S});else this.lastOnValueJob=this.lastOnValueJob.then(L);!this.parsingContext.streamingProfile&&C===0&&(this.lastOnValueJob=this.lastOnValueJob.then(()=>this.executeBufferedJobs()))}},this.jsonParser.onError=w=>{this.emit("error",w)}}isParsingContextInner(w){for(let C=w;C>0;C--)if(this.jsonParser.stack[C-1].key==="@context")return!0;return!1}async executeBufferedJobs(){for(const w of this.contextJobs)if(w)for(const C of w)await C();this.parsingContext.unaliasedKeywordCacheStack.splice(0);for(const w of this.contextAwaitingJobs){if(this.typeJobs.length>0){const C=[],S=[];for(let I=0;I<this.typeJobs.length;I++){const T=this.typeJobs[I];b.Util.isPrefixArray(T.keys,w.keys)&&(C.push(T),S.push(I))}const L=C.sort((I,T)=>I.keys.length-T.keys.length);for(const I of L)await I.job();const y=S.sort().reverse();for(const I of y)this.typeJobs.splice(I,1)}await w.job()}}};return z.JsonLdParser=m,m.DEFAULT_PROCESSING_MODE="1.1",m.ENTRY_HANDLERS=[new g.EntryHandlerArrayValue,new r.EntryHandlerKeywordContext,new e.EntryHandlerKeywordId,new l.EntryHandlerKeywordIncluded,new n.EntryHandlerKeywordGraph,new o.EntryHandlerKeywordNest,new s.EntryHandlerKeywordType,new h.EntryHandlerKeywordValue,new x.EntryHandlerKeywordAnnotation,new f.EntryHandlerContainer,new u.EntryHandlerKeywordUnknownFallback,new t.EntryHandlerPredicate,new c.EntryHandlerInvalidFallback],z}var Ct;function hr(){return Ct||(Ct=1,function(d){var E=q&&q.__createBinding||(Object.create?function(g,f,c,t){t===void 0&&(t=c);var r=Object.getOwnPropertyDescriptor(f,c);(!r||("get"in r?!f.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return f[c]}}),Object.defineProperty(g,t,r)}:function(g,f,c,t){t===void 0&&(t=c),g[t]=f[c]}),a=q&&q.__exportStar||function(g,f){for(var c in g)c!=="default"&&!Object.prototype.hasOwnProperty.call(f,c)&&E(f,g,c)};Object.defineProperty(d,"__esModule",{value:!0}),a(Lt(),d)}(q)),q}var yr=hr();const He="null:";function Er(d){return E=>E.termType!=="NamedNode"||!E.value.startsWith(He)?null:d.namedNode(E.value.slice(He.length))}function gr(d){const E=Er(d);return a=>{const g=E(a.subject),f=E(a.predicate),c=E(a.object),t=E(a.graph);return g||f||c||t?d.quad(g||a.subject,f||a.predicate,c||a.object,t||a.graph):a}}class pr{constructor(E,{baseIRI:a=He,context:g=null,documentLoader:f,factory:c=Gt}={}){const t=new yr.JsonLdParser({baseIRI:a,context:g,dataFactory:c,documentLoader:f,streamingProfile:!1});E.pipe(t);const r=gr(c),n=new $t.Transform({objectMode:!0,transform:(e,l,o)=>{o(null,r(e))}});return t.on("context",e=>{Object.entries(e).forEach(([l,o])=>{n.emit("prefix",l,c.namedNode(o))})}),t.on("error",e=>n.destroy(e)),t.pipe(n),Jt(n)}}class Kr extends Kt{constructor(E){super(pr,E)}}export{Kr as default};
